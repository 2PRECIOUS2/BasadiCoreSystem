import{a9 as X,aa as ee,k as e,r as a,Z as w,z as Q,W as p,v as F,T as n,B as S,y as A,I as L,Y as K,a0 as V,a1 as H,a2 as J,$ as De,t as je,P as ie,Q as ge,S as qe,ab as Oe}from"./index-a1e127f3.js";import{d as ae}from"./Close-da650117.js";import{d as Fe}from"./Inventory-089aa671.js";import{C as se,G as u}from"./Grid-6160672c.js";import{C as le}from"./CardContent-878de8ec.js";import{d as ve,a as ze}from"./MoreVert-b90270e1.js";import{d as Ne,a as Te}from"./Archive-e42270dc.js";import{d as Ee}from"./Search-6bcfcab5.js";import{D as Ue}from"./DialogActions-af98e3be.js";import{M as Le}from"./InputAdornment-188cdb3b.js";import{A as Be}from"./Avatar-0c89d31b.js";import{C as Ge}from"./Container-3f1efec7.js";var ce={},Qe=ee;Object.defineProperty(ce,"__esModule",{value:!0});var de=ce.default=void 0,Ve=Qe(X()),ne=e;de=ce.default=(0,Ve.default)([(0,ne.jsx)("path",{fillRule:"evenodd",d:"M16.67 13.13C18.04 14.06 19 15.32 19 17v3h4v-3c0-2.18-3.57-3.47-6.33-3.87"},"0"),(0,ne.jsx)("circle",{cx:"9",cy:"8",r:"4",fillRule:"evenodd"},"1"),(0,ne.jsx)("path",{fillRule:"evenodd",d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4c-.47 0-.91.1-1.33.24C14.5 5.27 15 6.58 15 8s-.5 2.73-1.33 3.76c.42.14.86.24 1.33.24m-6 1c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"},"2")],"PeopleAlt");var ue={},He=ee;Object.defineProperty(ue,"__esModule",{value:!0});var be=ue.default=void 0,Je=He(X()),Ye=e;be=ue.default=(0,Je.default)((0,Ye.jsx)("path",{d:"m22.7 19-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4"}),"Build");var he={},Ze=ee;Object.defineProperty(he,"__esModule",{value:!0});var ye=he.default=void 0,Ke=Ze(X()),Xe=e;ye=he.default=(0,Ke.default)((0,Xe.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline");var xe={},et=ee;Object.defineProperty(xe,"__esModule",{value:!0});var _e=xe.default=void 0,tt=et(X()),rt=e;_e=xe.default=(0,tt.default)((0,rt.jsx)("path",{d:"M7 11v2h10v-2zm5-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"RemoveCircleOutline");const at=({onProductAdded:_})=>{const[v,m]=a.useState({product_name:"",quantity:0,selling_price:0,category:""}),[b,I]=a.useState([]),[t,C]=a.useState([{materialId:"",measurement:"",unit:"",saved:!1}]),[M,P]=a.useState(0),[h,$]=a.useState(null),[k,y]=a.useState(null),R=["Fashion Accessories","Corporate Gifts","African print-inspired custom clothing"],g={"& .MuiInputBase-input":{fontWeight:"bold"},"& .MuiInputLabel-root":{fontWeight:"bold"}};a.useEffect(()=>{fetch(`${w}/api/material/all`,{credentials:"include"}).then(r=>r.json()).then(r=>I(r)).catch(r=>console.error("Error fetching materials for ProductForm:",r))},[]);const W=r=>{const{name:c,value:x}=r.target;m(T=>({...T,[c]:x}))},U=(r,c)=>{const{name:x,value:T}=c.target,i=[...t];if(i[r][x]=T,x==="materialId"){const d=b.find(f=>f.material_id===T);d&&(i[r].unit=d.unit)}(x==="measurement"||x==="materialId")&&(i[r].saved=!1),C(i)},D=()=>{C([...t,{materialId:"",measurement:"",unit:"",saved:!1}])},N=r=>{const c=[...t];c.splice(r,1),C(c),P(0)},q=r=>{const c=[...t];c[r].saved=!0,C(c)},z=()=>{let r=0;t.forEach(c=>{if(c.materialId&&c.measurement>0){const x=b.find(T=>T.material_id===c.materialId);x&&x.unit_price&&(r+=parseFloat(x.unit_price)*parseFloat(c.measurement))}}),P(r)};a.useEffect(()=>{z()},[t,b]);const o=()=>t.filter(r=>r.materialId&&r.measurement).map(r=>{const c=b.find(x=>x.material_id===r.materialId);return{materialId:r.materialId,measurement:parseFloat(r.measurement),unit:c?c.unit:""}}),s=async r=>{r.preventDefault();const c=new FormData;c.append("product_name",v.product_name),c.append("category",v.category),c.append("cost_of_production",M),c.append("selling_price",v.selling_price),c.append("quantity",v.quantity||0),c.append("materials",JSON.stringify(o())),k&&c.append("image",k);try{(await fetch(`${w}/api/products/add`,{method:"POST",body:c,credentials:"include"})).ok?($({type:"success",text:"Product added successfully!"}),m({product_name:"",selling_price:0,category:"",quantity:0}),C([{materialId:"",measurement:"",unit:"",saved:!1}]),P(0),y(null),_&&_()):$({type:"error",text:"Failed to add product."})}catch{$({type:"error",text:"Error adding product."})}};return e.jsx("form",{onSubmit:s,children:e.jsxs(Q,{spacing:3,children:[" ",e.jsx(p,{label:"Product Name",name:"product_name",fullWidth:!0,required:!0,value:v.product_name,onChange:W,sx:g}),e.jsx(p,{select:!0,label:"Category",name:"category",fullWidth:!0,required:!0,value:v.category,onChange:W,sx:g,children:R.map(r=>e.jsx(F,{value:r,children:r},r))}),e.jsx(se,{variant:"outlined",sx:{p:2},children:e.jsxs(le,{children:[e.jsx(n,{variant:"subtitle1",gutterBottom:!0,children:"Material Used and Measurements"}),t.map((r,c)=>e.jsxs(S,{sx:{display:"flex",alignItems:"center",mb:2,gap:1},children:[e.jsx(p,{select:!0,label:"Material",name:"materialId",value:r.materialId,onChange:x=>U(c,x),sx:{flexGrow:1,...g},required:!0,children:b.length>0?b.map(x=>e.jsxs(F,{value:x.material_id,children:[x.material_name," (",x.unit,")"]},x.material_id)):e.jsx(F,{disabled:!0,children:"No materials found"})}),e.jsx(p,{label:"Measurement",name:"measurement",type:"number",value:r.measurement,onChange:x=>U(c,x),inputProps:{min:0,step:"any"},sx:{width:180,...g},required:!0}),e.jsx(p,{label:"Unit",name:"unit",value:r.unit,sx:{width:100,...g},InputProps:{readOnly:!0},disabled:!0}),e.jsx(A,{variant:r.saved?"outlined":"contained",size:"small",onClick:()=>q(c),disabled:!r.materialId||r.measurement<=0,children:r.saved?"Saved":"Save"}),t.length>1&&e.jsx(L,{color:"error",onClick:()=>N(c),"aria-label":"remove material line",children:e.jsx(_e,{})})]},c)),e.jsx(A,{variant:"text",startIcon:e.jsx(ye,{}),onClick:D,sx:{mt:1},children:"Add another material"})]})}),e.jsx(p,{label:"Quantity (Initial stock - will change when products are made)",name:"quantity",type:"number",fullWidth:!0,disabled:!0,value:v.quantity,onChange:W,inputProps:{min:0,step:"1"}}),e.jsx(S,{sx:{border:"1px solid #ccc",p:2,borderRadius:"4px",mt:2},children:e.jsxs(n,{variant:"h6",sx:{fontWeight:"bold"},children:["Cost of Production: R",M.toFixed(2)]})}),e.jsx(p,{label:"Selling Price",name:"selling_price",type:"number",fullWidth:!0,required:!0,value:v.selling_price,onChange:W,inputProps:{min:0,step:"0.01"},sx:g}),e.jsx(p,{type:"file",onChange:r=>y(r.target.files[0]),inputProps:{accept:"image/*"}}),h&&e.jsx(K,{severity:h.type,children:h.text}),e.jsx(A,{variant:"contained",type:"submit",size:"large",children:"Add Product"})]})})};var me={},st=ee;Object.defineProperty(me,"__esModule",{value:!0});var oe=me.default=void 0,it=st(X()),nt=e;oe=me.default=(0,it.default)((0,nt.jsx)("path",{d:"m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8z"}),"ArrowUpward");var pe={},ot=ee;Object.defineProperty(pe,"__esModule",{value:!0});var Se=pe.default=void 0,lt=ot(X()),ct=e;Se=pe.default=(0,lt.default)((0,ct.jsx)("path",{d:"m20 12-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8z"}),"ArrowDownward");const dt=({open:_,onClose:v,product:m,onUpdate:b,productMaterials:I})=>{const[t,C]=a.useState({product_name:"",category:"",selling_price:0}),[M,P]=a.useState(0),[h,$]=a.useState(0),[k,y]=a.useState(!1),[R,g]=a.useState([]),[W,U]=a.useState([]),[D,N]=a.useState(null),[q,z]=a.useState(null),o=["Fashion Accessories","Corporate Gifts","African print-inspired custom clothing"];a.useEffect(()=>{if(m&&_){C({product_name:m.product_name||"",category:m.category||"",selling_price:Number(m.selling_price)||0});const i=Number(m.cost_of_production)||0;if(P(i),$(i),y(!1),Array.isArray(I)&&I.length>0){const d=I.map(f=>({id:f.material_id,materialId:f.material_id,measurement:Number(f.measurement)||0,unit:f.unit||"",material_name:f.material_name||"",unit_price:f.unit_price||"",saved:!0}));g(d)}else s(m.product_id)}},[m,_,I]),a.useEffect(()=>{_&&fetch(`${w}/api/material/all`,{credentials:"include"}).then(i=>i.json()).then(i=>U(i)).catch(i=>console.error("Error fetching materials:",i))},[_]);const s=async i=>{try{const d=await fetch(`${w}/api/products/${i}/materials`,{credentials:"include"});if(!d.ok){console.warn(`Materials endpoint returned ${d.status}, using default material`),g([{materialId:"",measurement:"",unit:"",saved:!1}]);return}const f=await d.json();if(console.log("Fetched materials:",f),f&&f.length>0){const O=f.map(B=>({id:B.material_id,materialId:B.material_id,measurement:Number(B.measurement)||0,unit:B.unit||"",saved:!0}));g(O)}else g([{materialId:"",measurement:"",unit:"",saved:!1}])}catch(d){console.error("Error fetching product materials:",d),g([{materialId:"",measurement:"",unit:"",saved:!1}])}},r=i=>{const{name:d,value:f}=i.target;C(O=>({...O,[d]:f}))},c=()=>{if(!k){P(h);return}let i=0;R.forEach(d=>{if(d.materialId&&d.measurement>0){const f=W.find(O=>O.material_id===d.materialId);if(f&&f.unit_price){const O=Number(f.unit_price)||0,B=Number(d.measurement)||0;i+=O*B}}}),P(i)};a.useEffect(()=>{c()},[R,W,k,h]);const x=()=>R.filter(i=>i.materialId&&i.measurement).map(i=>{const d=W.find(f=>f.material_id===i.materialId);return{id:i.material_id||null,materialId:i.materialId,measurement:parseFloat(i.measurement),unit:d?d.unit:""}}),T=async i=>{if(i.preventDefault(),!m||!m.product_id){z({type:"error",text:"Product ID is missing. Cannot update."});return}const d=new FormData;d.append("product_name",t.product_name),d.append("category",t.category),d.append("cost_of_production",Number(M)||0),d.append("selling_price",Number(t.selling_price)||0),d.append("materials_modified",k.toString()),d.append("materials",JSON.stringify(x())),D&&d.append("image",D);try{const f=await fetch(`${w}/api/products/${m.product_id}`,{method:"PUT",body:d,credentials:"include"}),O=await f.json();f.ok?(z({type:"success",text:"Product updated successfully!"}),setTimeout(()=>{b(),v()},1500)):z({type:"error",text:O.message||"Failed to update product."})}catch(f){console.error("Error:",f),z({type:"error",text:"Server error"})}};return e.jsxs(V,{open:_,onClose:v,maxWidth:"md",fullWidth:!0,children:[e.jsxs(H,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{children:["Update Product: ",m==null?void 0:m.product_name]}),e.jsx(L,{"aria-label":"close",onClick:v,size:"small",children:e.jsx("span",{"aria-hidden":"true",children:"Ã—"})})]}),e.jsxs("form",{onSubmit:T,children:[e.jsx(J,{children:e.jsxs(Q,{spacing:3,children:[e.jsx(p,{label:"Product Name",name:"product_name",fullWidth:!0,required:!0,value:t.product_name,onChange:r}),e.jsx(p,{select:!0,label:"Category",name:"category",fullWidth:!0,required:!0,value:t.category,onChange:r,children:o.map(i=>e.jsx(F,{value:i,children:i},i))}),e.jsx(se,{variant:"outlined",children:e.jsxs(le,{children:[e.jsxs(n,{variant:"subtitle1",gutterBottom:!0,children:["Material Used and Measurements",k&&e.jsx(n,{variant:"caption",color:"primary",sx:{ml:1},children:"(Modified - cost will be recalculated)"})]}),R.length===0?e.jsx(n,{color:"text.secondary",sx:{mb:2},children:"No materials found for this product."}):e.jsxs(S,{sx:{mb:2,bgcolor:"#f5f7fa",borderRadius:3,p:2,boxShadow:1},children:[e.jsxs(u,{container:!0,spacing:2,sx:{mb:1},children:[e.jsx(u,{item:!0,xs:5,children:e.jsx(n,{sx:{fontWeight:600},children:"Material"})}),e.jsx(u,{item:!0,xs:3,children:e.jsx(n,{sx:{fontWeight:600},children:"Measurement"})}),e.jsx(u,{item:!0,xs:2,children:e.jsx(n,{sx:{fontWeight:600},children:"Unit"})}),e.jsx(u,{item:!0,xs:2,children:e.jsx(n,{sx:{fontWeight:600},children:"Unit Price"})})]}),R.map((i,d)=>e.jsxs(u,{container:!0,spacing:2,alignItems:"center",sx:{mb:1,bgcolor:"#fff",borderRadius:2,p:1,border:"1px solid #e0e0e0"},children:[e.jsx(u,{item:!0,xs:5,children:e.jsx(p,{value:i.material_name,label:"Material",InputProps:{readOnly:!0},fullWidth:!0})}),e.jsx(u,{item:!0,xs:3,children:e.jsx(p,{value:i.measurement,label:"Measurement",InputProps:{readOnly:!0},fullWidth:!0})}),e.jsx(u,{item:!0,xs:2,children:e.jsx(p,{value:i.unit,label:"Unit",InputProps:{readOnly:!0},fullWidth:!0})}),e.jsx(u,{item:!0,xs:2,children:e.jsx(p,{value:i.unit_price,label:"Unit Price",InputProps:{readOnly:!0,startAdornment:e.jsx(n,{sx:{mr:1},children:"R"})},fullWidth:!0})})]},d))]})]})}),e.jsxs(S,{sx:{border:"1px solid #ccc",p:2,borderRadius:"4px",backgroundColor:k?"#e3f2fd":"#f5f5f5"},children:[e.jsxs(n,{variant:"h6",sx:{fontWeight:"bold",color:"text.secondary"},children:["Cost of Production: R",(Number(M)||0).toFixed(2)]}),e.jsx(n,{variant:"caption",color:"text.secondary",children:k?"* Recalculated from modified materials":"* Original cost (materials unchanged)"})]}),e.jsx(p,{label:"Selling Price",name:"selling_price",type:"number",fullWidth:!0,required:!0,value:t.selling_price,InputProps:{readOnly:!0},sx:{bgcolor:"#f5f5f5",fontWeight:600}}),e.jsxs(S,{sx:{border:"1px solid #ccc",p:2,borderRadius:"4px",backgroundColor:"#f5f5f5"},children:[e.jsxs(n,{variant:"body1",sx:{fontWeight:"bold",color:"text.secondary"},children:["Current Quantity: ",Number(m==null?void 0:m.quantity)||0]}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"* Managed by manufacturing/sales processes (read-only)"})]}),e.jsx(p,{type:"file",onChange:i=>N(i.target.files[0]),helperText:"Upload new image (optional)"}),q&&e.jsx(K,{severity:q.type,children:q.text})]})}),e.jsxs(Ue,{children:[e.jsx(A,{onClick:v,children:"Cancel"}),e.jsx(A,{type:"submit",variant:"contained",children:"Update Product"})]})]})]})},ut=({refreshTrigger:_})=>{const[v,m]=a.useState([]),[b,I]=a.useState(!0),[t,C]=a.useState(null),[M,P]=a.useState(null),[h,$]=a.useState(null),[k,y]=a.useState([]),[R,g]=a.useState([]),[W,U]=a.useState("product_name"),[D,N]=a.useState(""),[q,z]=a.useState(!1),[o,s]=a.useState(!1),[r,c]=a.useState(!1),[x,T]=a.useState("active"),[i,d]=a.useState(""),f=l=>{if(!l)return"/images/products/placeholder.png";const j=l.replace(/^\/images\/products\//,"");return`${w}/images/products/${j}`},O=async()=>{try{I(!0),C(null);let l=`${w}/api/products/all`;x&&(l+=`?status=${encodeURIComponent(x)}`);const j=await fetch(l,{credentials:"include"});if(!j.ok)throw new Error(`HTTP error! status: ${j.status}`);const G=await j.json();G.success&&Array.isArray(G.data)?m(G.data):Array.isArray(G)?m(G):(C("Invalid response format from server"),m([]))}catch(l){C(l.message),m([])}finally{I(!1)}};a.useEffect(()=>{O(),fetch(`${w}/api/material/all`,{credentials:"include"}).then(l=>l.json()).then(l=>{Array.isArray(l)?g(l):l.data&&Array.isArray(l.data)?g(l.data):g([])}).catch(()=>g([]))},[x]),a.useEffect(()=>{_&&O()},[_]);const B=Array.isArray(v)?v.filter(l=>{if(!l)return!1;const j=D.toLowerCase();return j?W==="product_name"?l.product_name&&l.product_name.toLowerCase().includes(j):W==="category"?l.category&&l.category.toLowerCase().includes(j):!0:!0}):[],Ce=async(l,j)=>{if(P(l.currentTarget),$(j),j!=null&&j.product_id)try{const E=await(await fetch(`${w}/api/products/${j.product_id}/materials`,{credentials:"include"})).json();if(E.success&&Array.isArray(E.data)){const $e=E.data.map(te=>{const Z=R.find(Re=>Re.material_id===te.material_id);return{...te,material_name:Z?Z.material_name:te.material_name,unit_price:Z?Z.unit_price:te.unit_price,unit:Z?Z.unit:te.unit}});y($e)}else y([])}catch{y([])}else y([])},fe=l=>{T(l),N("")},Pe=()=>{s(!0),re()},we=()=>{c(!0),re()},ke=async()=>{if(h){try{(await fetch(`${w}/api/products/${h.product_id}/archive`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?(d("Product archived successfully"),O()):d("Failed to archive product")}catch{d("Network error")}s(!1),$(null)}},We=async()=>{if(h){try{(await fetch(`${w}/api/products/${h.product_id}/restore`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?(d("Product restored successfully"),O()):d("Failed to restore product")}catch{d("Network error")}c(!1),$(null)}},Ie=l=>{l.preventDefault()},re=()=>{P(null)},Ae=()=>{z(!0),re()},Me=()=>{O(),z(!1),$(null),y([])},Y={};return B.forEach(l=>{!l||!l.category||(Y[l.category]||(Y[l.category]=[]),Y[l.category].push(l))}),e.jsxs(e.Fragment,{children:[i&&e.jsx(K,{severity:"success",sx:{mb:2},onClose:()=>d(""),children:i}),e.jsxs(S,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(A,{variant:x==="active"?"contained":"outlined",onClick:()=>fe("active"),size:"small",children:"Active Products"}),e.jsx(A,{variant:x==="archived"?"contained":"outlined",onClick:()=>fe("archived"),color:"warning",size:"small",children:"Archived Products"})]}),e.jsxs(S,{sx:{display:"flex",alignItems:"center",mb:2,gap:2},children:[e.jsxs(De,{value:W,onChange:l=>U(l.target.value),size:"small",sx:{minWidth:140},children:[e.jsx(F,{value:"product_name",children:"Product Name"}),e.jsx(F,{value:"category",children:"Category"})]}),e.jsx("form",{onSubmit:Ie,style:{flex:1},children:e.jsx(p,{size:"small",placeholder:`Search by ${W.replace("_"," ")}`,value:D,onChange:l=>N(l.target.value),InputProps:{endAdornment:e.jsx(Le,{position:"end",children:e.jsx(L,{type:"submit",size:"small",children:e.jsx(Ee,{})})})},fullWidth:!0})})]}),Object.keys(Y).length===0?e.jsx(n,{variant:"body1",sx:{mt:2,textAlign:"center"},children:x==="archived"?"No archived products found.":"No products found."}):Object.keys(Y).map(l=>e.jsxs(S,{sx:{mb:4},children:[e.jsx(n,{variant:"h5",sx:{fontWeight:700,mb:2,color:"primary.main"},children:l}),e.jsx(u,{container:!0,spacing:3,children:Y[l].map(j=>{const G=f(j.image_path);return e.jsx(u,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(se,{elevation:2,sx:{borderRadius:4,p:2,height:220,minWidth:180,maxWidth:260,boxShadow:"0 2px 8px rgba(0,0,0,0.08)",position:"relative",background:"#fff",opacity:j.status==="archived"?.7:1,border:j.status==="archived"?"2px dashed #ff9800":"2px solid #ff9800",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",transition:"border-color 0.2s","&:hover":{borderColor:"#1565c0",boxShadow:"0 4px 16px rgba(25, 118, 210, 0.15)"}},children:[e.jsxs(S,{sx:{position:"absolute",top:8,right:12,display:"flex",alignItems:"center",gap:.5},children:[e.jsxs(n,{variant:"body2",sx:{fontWeight:500,color:"grey.700",fontSize:14},children:["Qty : ",j.quantity||0]}),(()=>{const E=Number(j.quantity)||0;return E<10?e.jsx(Se,{sx:{color:"red",fontSize:18,ml:.5}}):E>=10&&E<=30?e.jsx(oe,{sx:{color:"red",fontSize:18,ml:.5}}):E>30?e.jsx(oe,{sx:{color:"green",fontSize:18,ml:.5}}):null})()]}),e.jsx(S,{sx:{mt:2,mb:1,display:"flex",justifyContent:"center",width:"100%"},children:e.jsx(Be,{variant:"square",src:G,sx:{width:64,height:64,borderRadius:2,boxShadow:1},onError:E=>{E.target.src="/images/products/placeholder.png"}})}),e.jsx(n,{variant:"subtitle1",sx:{fontWeight:600,textAlign:"center",mt:1,mb:.5,fontSize:16},children:j.product_name||"Unnamed Product"}),e.jsx(S,{sx:{position:"absolute",left:12,bottom:12},children:e.jsxs(n,{variant:"body1",sx:{fontWeight:700,color:"primary.main",fontSize:18},children:["R",j.selling_price?Number(j.selling_price).toFixed(2):"0.00"]})}),e.jsx(S,{sx:{position:"absolute",right:8,bottom:8},children:e.jsx(L,{onClick:E=>Ce(E,j),size:"small",children:e.jsx(ve,{})})})]})},j.product_id)})})]},l)),e.jsx(dt,{open:q,product:h,productMaterials:k,onUpdate:Me}),e.jsx(je,{anchorEl:M,open:!!M,onClose:re,children:h&&h.status==="active"?[e.jsxs(F,{onClick:Ae,sx:{color:"primary.main"},children:[e.jsx(ze,{sx:{mr:1,color:"#1976d2"},fontSize:"small"}),"Update"]},"update"),e.jsxs(F,{onClick:Pe,sx:{color:"error.main"},children:[e.jsx(Ne,{sx:{mr:1,color:"#d32f2f"},fontSize:"small"}),"Archive"]},"archive")]:[e.jsxs(F,{onClick:we,sx:{color:"success.main"},children:[e.jsx(Te,{sx:{mr:1,color:"#388e3c"},fontSize:"small"}),"Restore"]},"restore")]}),e.jsxs(V,{open:o,onClose:()=>s(!1),children:[e.jsx(H,{children:"Archive Product"}),e.jsxs(J,{children:[e.jsxs(n,{sx:{mb:2},children:["Are you sure you want to archive ",e.jsx("b",{children:h==null?void 0:h.product_name}),"?"]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"This will:"}),e.jsxs(n,{variant:"body2",component:"ul",sx:{pl:2},children:[e.jsx("li",{children:"Hide the product from searches and sales"}),e.jsx("li",{children:"Prevent new products from being made or bought"}),e.jsx("li",{children:"Change the status to archived"}),e.jsx("li",{children:"Product can be restored later if needed"})]}),e.jsxs(Q,{direction:"row",spacing:2,sx:{mt:3,justifyContent:"flex-end"},children:[e.jsx(A,{onClick:()=>s(!1),children:"Cancel"}),e.jsx(A,{onClick:ke,color:"error",variant:"contained",children:"Archive Product"})]})]})]}),e.jsxs(V,{open:r,onClose:()=>c(!1),children:[e.jsx(H,{children:"Restore Product"}),e.jsxs(J,{children:[e.jsxs(n,{sx:{mb:2},children:["Are you sure you want to restore ",e.jsx("b",{children:h==null?void 0:h.product_name}),"?"]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"This will:"}),e.jsxs(n,{variant:"body2",component:"ul",sx:{pl:2},children:[e.jsx("li",{children:"Make the product available for searches and sales"}),e.jsx("li",{children:"Allow new products to be made or bought"}),e.jsx("li",{children:"Change the status to active"})]}),e.jsxs(Q,{direction:"row",spacing:2,sx:{mt:3,justifyContent:"flex-end"},children:[e.jsx(A,{onClick:()=>c(!1),children:"Cancel"}),e.jsx(A,{onClick:We,color:"success",variant:"contained",children:"Restore Product"})]})]})]})]})},ht=({onProductMade:_})=>{const[v,m]=a.useState([]),[b,I]=a.useState([]),[t,C]=a.useState({product_id:"",method:"",quantity:"",production_date:"",provider_id:"",service_cost:""}),[M,P]=a.useState("0.00"),[h,$]=a.useState(!0),[k,y]=a.useState(""),[R,g]=a.useState(""),[W,U]=a.useState([]),[D,N]=a.useState(0);a.useEffect(()=>{fetch(`${w}/api/service-providers`,{credentials:"include"}).then(o=>o.json()).then(o=>U(o.data||[])).catch(()=>U([]))},[]),a.useEffect(()=>{fetch(`${w}/api/products/all`,{credentials:"include"}).then(o=>o.json()).then(o=>m(o.data||[])).catch(()=>m([])).finally(()=>$(!1))},[]),a.useEffect(()=>{t.product_id&&t.method==="scratch"?fetch(`${w}/api/products/${t.product_id}/materials`,{credentials:"include"}).then(o=>o.json()).then(o=>I(o.data||[])).catch(()=>I([])):I([])},[t.product_id,t.method]),a.useEffect(()=>{t.product_id?fetch(`${w}/api/products/${t.product_id}`,{credentials:"include"}).then(o=>o.json()).then(o=>{var s;N(((s=o.data)==null?void 0:s.cost_of_production)||0)}).catch(()=>N(0)):N(0)},[t.product_id]),a.useEffect(()=>{t.method==="scratch"&&t.quantity?P((parseFloat(D)*parseInt(t.quantity)).toFixed(2)):t.method==="provider"&&t.service_cost&&t.quantity?P((parseFloat(t.service_cost)*parseInt(t.quantity)).toFixed(2)):P("0.00")},[t.quantity,t.method,D,t.service_cost]);const q=o=>{const{name:s,value:r}=o.target;C(c=>({...c,[s]:r}))},z=async()=>{if(!t.method){y("Please select a production method."),setTimeout(()=>y(""),3e3);return}try{const o={product_id:t.product_id,production_method:t.method,quantity:parseInt(t.quantity),production_date:t.production_date,total_cost:parseFloat(M),materials_used:t.method==="scratch"?b.map(r=>({material_id:r.material_id,measurement:r.measurement,unit:r.unit,unit_price:r.unit_price})):[],provider_id:t.method==="provider"?t.provider_id:null,cost_of_production:t.method==="provider"?parseFloat(t.service_cost):parseFloat(D)};console.log("Submitting production payload:",o);const s=await fetch(`${w}/api/production`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(o)});if(s.ok)g("Product manufacturing record created successfully!"),C({product_id:"",method:"",quantity:"",production_date:"",provider_id:"",service_cost:""}),I([]),setTimeout(()=>g(""),3e3),_&&_();else{const r=await s.json();y(r.message||"Failed to create production record"),setTimeout(()=>y(""),3e3)}}catch{y("Error submitting form"),setTimeout(()=>y(""),3e3)}};return h?e.jsxs(ie,{elevation:4,sx:{p:5,maxWidth:600,mx:"auto",mt:6,borderRadius:4,bgcolor:"#f8fafc"},children:[e.jsx(n,{variant:"h4",align:"center",sx:{mb:3,fontWeight:700},children:"Make Product"}),e.jsx(n,{children:"Loading products..."})]}):e.jsxs(ie,{elevation:4,sx:{p:5,maxWidth:600,mx:"auto",mt:6,borderRadius:4,bgcolor:"#f8fafc"},children:[e.jsx(n,{variant:"h4",align:"center",sx:{mb:3,fontWeight:700},children:"Make Product"}),k&&e.jsx(K,{severity:"error",sx:{mb:2},children:k}),R&&e.jsx(K,{severity:"success",sx:{mb:2},children:R}),e.jsxs(u,{container:!0,spacing:3,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(p,{select:!0,fullWidth:!0,required:!0,label:"Product Name",name:"product_id",value:t.product_id,onChange:q,size:"large",sx:{fontSize:20},children:v.map(o=>e.jsx(F,{value:o.product_id,children:o.product_name},o.product_id))})}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(p,{select:!0,fullWidth:!0,required:!0,label:"Production Method",name:"method",value:t.method,onChange:q,size:"large",children:[e.jsx(F,{value:"scratch",children:"Made from Scratch"}),e.jsx(F,{value:"provider",children:"Service Provider"})]})}),t.method==="scratch"&&e.jsx(u,{item:!0,xs:12,children:e.jsxs(S,{sx:{mt:2,mb:2},children:[e.jsx(ge,{sx:{mb:2}}),e.jsx(n,{variant:"h6",sx:{mb:2,fontWeight:700},children:"Materials Used"}),e.jsxs(u,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(u,{item:!0,xs:3,children:e.jsx(n,{sx:{fontWeight:600},children:"Material Name"})}),e.jsx(u,{item:!0,xs:3,children:e.jsx(n,{sx:{fontWeight:600},children:"Measurement"})}),e.jsx(u,{item:!0,xs:2,children:e.jsx(n,{sx:{fontWeight:600},children:"Unit"})}),e.jsx(u,{item:!0,xs:4,children:e.jsx(n,{sx:{fontWeight:600},children:"Unit Price"})})]}),b.length>0?b.map((o,s)=>e.jsxs(u,{container:!0,spacing:2,alignItems:"center",sx:{mb:1},children:[e.jsx(u,{item:!0,xs:3,children:e.jsx(p,{value:o.material_name,fullWidth:!0,InputProps:{readOnly:!0},variant:"outlined"})}),e.jsx(u,{item:!0,xs:3,children:e.jsx(p,{value:o.measurement,fullWidth:!0,InputProps:{readOnly:!0},variant:"outlined"})}),e.jsx(u,{item:!0,xs:2,children:e.jsx(p,{value:o.unit,fullWidth:!0,InputProps:{readOnly:!0},variant:"outlined"})}),e.jsx(u,{item:!0,xs:4,children:e.jsx(p,{value:o.unit_price,fullWidth:!0,InputProps:{readOnly:!0,startAdornment:e.jsx(n,{sx:{mr:1},children:"R"})},variant:"outlined"})})]},o.product_material_id||s)):e.jsx(n,{color:"text.secondary",sx:{mt:2},children:"No materials found for this product."}),e.jsx(p,{label:"Cost of Production (per unit)",value:D,fullWidth:!0,InputProps:{readOnly:!0},variant:"outlined",sx:{mt:2}})]})}),t.method==="provider"&&e.jsx(u,{item:!0,xs:12,children:e.jsxs(S,{sx:{mt:2,mb:2},children:[e.jsx(ge,{sx:{mb:2}}),e.jsx(n,{variant:"h6",sx:{mb:2,fontWeight:700},children:"Service Provider"}),e.jsxs(u,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(u,{item:!0,xs:6,children:e.jsx(p,{select:!0,label:"Service Provider Name",name:"provider_id",value:t.provider_id,onChange:q,fullWidth:!0,required:!0,children:W.map(o=>e.jsx(F,{value:o.provider_id,children:o.provider_name},o.provider_id))})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(p,{label:"Service Cost",name:"service_cost",type:"number",value:t.service_cost,onChange:q,fullWidth:!0,required:!0})})]})]})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(p,{fullWidth:!0,required:!0,label:"Quantity",name:"quantity",type:"number",value:t.quantity,onChange:q,size:"large",inputProps:{min:1}})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(p,{fullWidth:!0,required:!0,label:"Production Date",name:"production_date",type:"date",value:t.production_date,onChange:q,InputLabelProps:{shrink:!0},size:"large"})}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(ie,{sx:{p:2,bgcolor:"#e0f7fa",borderRadius:2,textAlign:"center",fontSize:22,fontWeight:600,color:"primary.main"},children:["Total Cost: R",M]})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(A,{variant:"contained",color:"primary",fullWidth:!0,size:"large",sx:{py:2,fontSize:18,fontWeight:700},disabled:!t.product_id||!t.method||!t.quantity||!t.production_date,onClick:z,children:"Make Product Stock"})})]})]})},xt=({open:_,onClose:v})=>{const[m,b]=a.useState([]),[I,t]=a.useState(!0),[C,M]=a.useState(null),[P,h]=a.useState(""),[$,k]=a.useState(null);a.useEffect(()=>{_&&(t(!0),fetch(`${w}/api/service-providers`,{credentials:"include"}).then(s=>s.json()).then(s=>{s.success&&Array.isArray(s.data)?b(s.data):b([]),t(!1)}).catch(()=>{b([]),t(!1),M("Failed to fetch service providers")}))},[_]);const[y,R]=a.useState(null),[g,W]=a.useState(!1);a.useEffect(()=>{_&&(t(!0),fetch(`${w}/api/service-providers`,{credentials:"include"}).then(s=>s.json()).then(s=>{s.success&&Array.isArray(s.data)?b(s.data):b([]),t(!1)}).catch(()=>{b([]),t(!1),M("Failed to fetch service providers")}))},[_,P]);const U=(s,r)=>{k(s.currentTarget),R(r)},D=()=>{k(null),R(null)},N=async()=>{if(y){try{(await fetch(`${w}/api/service-providers/${y.provider_id}/archive`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?h("Service provider archived"):h("Failed to archive")}catch{h("Network error")}D()}},q=()=>{h("Update not implemented"),D()},z=()=>{W(!0)},o=()=>{W(!1)};return e.jsxs(V,{open:_,onClose:v,fullScreen:!0,TransitionComponent:qe,TransitionProps:{direction:"up"},children:[e.jsxs(H,{children:["Service Providers",e.jsx(L,{"aria-label":"close",onClick:v,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(ae,{})})]}),e.jsxs(J,{dividers:!0,children:[e.jsx(Q,{direction:"row",justifyContent:"flex-end",sx:{mb:2},children:e.jsx(A,{variant:"contained",color:"warning",startIcon:e.jsx(de,{sx:{color:"#fff",fontSize:24}}),onClick:z,sx:{fontWeight:600,letterSpacing:1,fontSize:16,borderRadius:2},children:"Add New Service Provider"})}),P&&e.jsx(K,{severity:"success",sx:{mb:2},onClose:()=>h(""),children:P}),I?e.jsx(n,{children:"Loading service providers..."}):C?e.jsx(n,{color:"error",children:C}):e.jsx(u,{container:!0,spacing:3,children:m.length===0?e.jsx(u,{item:!0,xs:12,children:e.jsx(n,{children:"No service providers found."})}):m.map(s=>e.jsx(u,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(se,{elevation:2,sx:{borderRadius:3,p:2,position:"relative"},children:[e.jsxs(le,{children:[e.jsx(n,{variant:"h6",sx:{fontWeight:600},children:s.provider_name}),e.jsx(n,{variant:"body2",sx:{color:"text.secondary",mb:1},children:s.provider_location}),e.jsx(n,{variant:"body2",sx:{color:"text.secondary"},children:s.provider_email}),e.jsx(n,{variant:"body2",sx:{color:"text.secondary"},children:s.provider_number})]}),e.jsx(S,{sx:{position:"absolute",right:8,top:8},children:e.jsx(L,{onClick:r=>U(r,s),size:"small",children:e.jsx(ve,{})})})]})},s.provider_id))}),e.jsxs(V,{open:g,onClose:o,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(H,{children:["Add New Service Provider",e.jsx(L,{"aria-label":"close",onClick:o,sx:{position:"absolute",right:8,top:8,color:s=>s.palette.grey[500]},children:e.jsx(ae,{})})]}),e.jsx(J,{dividers:!0,children:e.jsxs(S,{component:"form",sx:{display:"flex",flexDirection:"column",gap:2},onSubmit:async s=>{s.preventDefault();const r=new FormData(s.currentTarget),c=r.get("name"),x=r.get("location"),T=r.get("contact_number"),i=r.get("email");try{(await fetch(`${w}/api/service-providers`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:c,location:x,contact_number:T,email:i})})).ok?(h("Service provider added"),W(!1)):h("Failed to add service provider")}catch{h("Network error")}},children:[e.jsx(p,{name:"name",label:"Provider Name",required:!0,fullWidth:!0}),e.jsx(p,{name:"location",label:"Location",required:!0,fullWidth:!0}),e.jsx(p,{name:"contact_number",label:"Contact Number",required:!0,fullWidth:!0}),e.jsx(p,{name:"email",label:"Email",type:"email",required:!0,fullWidth:!0}),e.jsxs(Q,{direction:"row",spacing:2,sx:{mt:2,justifyContent:"flex-end"},children:[e.jsx(A,{onClick:o,children:"Cancel"}),e.jsx(A,{type:"submit",variant:"contained",color:"warning",children:"Add Provider"})]})]})})]}),e.jsxs(je,{anchorEl:$,open:!!$,onClose:D,children:[e.jsx(F,{onClick:q,children:"Update"}),e.jsx(F,{onClick:N,sx:{color:"error.main"},children:"Archive"})]})]})]})},wt=()=>{const[_,v]=a.useState(!1),[m,b]=a.useState(!1),[I,t]=a.useState(!1),[C,M]=a.useState(0),P=()=>{v(!0)},h=()=>{v(!1)},$=()=>{M(g=>g+1),v(!1)},k=()=>t(!0),y=()=>t(!1),R=()=>{M(g=>g+1),t(!1)};return e.jsxs(S,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",py:4,px:2},children:[e.jsxs(Ge,{maxWidth:"lg",children:[e.jsxs(S,{sx:{background:"white",borderRadius:4,p:4,mb:4,boxShadow:"0 20px 60px rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:3},children:[e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(S,{sx:{width:80,height:80,borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 8px 24px rgba(102, 126, 234, 0.4)"},children:e.jsx(Fe,{sx:{fontSize:40,color:"white"}})}),e.jsxs(S,{children:[e.jsx(n,{variant:"h3",sx:{fontWeight:800,letterSpacing:1,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textTransform:"uppercase"},children:"Product Management"}),e.jsx(n,{sx:{color:"text.secondary",fontSize:16,mt:.5,fontWeight:500},children:"ðŸŽ¨ Create, manage, and track your products"})]})]}),e.jsxs(Q,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(A,{variant:"contained",startIcon:e.jsx(Oe,{}),onClick:P,sx:{py:1.5,px:3,fontWeight:700,letterSpacing:1,fontSize:15,borderRadius:2,background:"linear-gradient(90deg, #1976d2 0%, #64b5f6 100%)",boxShadow:"0 4px 15px rgba(25, 118, 210, 0.4)",transition:"all 0.3s ease",textTransform:"none","&:hover":{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(25, 118, 210, 0.6)",background:"linear-gradient(90deg, #1565c0 0%, #42a5f5 100%)"}},children:"New Product"}),e.jsx(A,{variant:"contained",startIcon:e.jsx(be,{}),onClick:k,sx:{py:1.5,px:3,fontWeight:700,letterSpacing:1,fontSize:15,borderRadius:2,background:"linear-gradient(90deg, #9c27b0 0%, #ba68c8 100%)",boxShadow:"0 4px 15px rgba(156, 39, 176, 0.4)",transition:"all 0.3s ease",textTransform:"none","&:hover":{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(156, 39, 176, 0.6)",background:"linear-gradient(90deg, #7b1fa2 0%, #ab47bc 100%)"}},children:"Make Products"}),e.jsx(A,{variant:"outlined",startIcon:e.jsx(de,{}),onClick:()=>b(!0),sx:{py:1.5,px:3,fontWeight:700,letterSpacing:1,fontSize:15,borderRadius:2,borderWidth:2,borderColor:"#ff9800",color:"#ff9800",textTransform:"none",transition:"all 0.3s ease","&:hover":{borderWidth:2,borderColor:"#f57c00",backgroundColor:"rgba(255, 152, 0, 0.1)",transform:"translateY(-2px)"}},children:"Service Providers"})]})]}),e.jsxs(S,{sx:{background:"white",borderRadius:4,p:4,boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsx(n,{variant:"h5",sx:{mb:3,fontWeight:700,color:"#667eea",letterSpacing:.5},children:"Product Catalog"}),e.jsx(ut,{refreshTrigger:C})]})]}),e.jsxs(V,{open:_,onClose:h,fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{borderRadius:3,boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},children:[e.jsxs(H,{sx:{m:0,p:3,background:"linear-gradient(135deg, #1976d2 0%, #64b5f6 100%)",color:"white",fontWeight:700,fontSize:20,letterSpacing:1},children:["Add New Product",e.jsx(L,{"aria-label":"close",onClick:h,sx:{position:"absolute",right:8,top:8,color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.2)"}},children:e.jsx(ae,{})})]}),e.jsx(J,{dividers:!0,sx:{p:3},children:e.jsx(at,{onProductAdded:$})})]}),e.jsxs(V,{open:I,onClose:y,fullWidth:!0,maxWidth:"md",PaperProps:{sx:{borderRadius:3,boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},children:[e.jsxs(H,{sx:{m:0,p:3,background:"linear-gradient(135deg, #9c27b0 0%, #ba68c8 100%)",color:"white",fontWeight:700,fontSize:20,letterSpacing:1},children:["Make Product",e.jsx(L,{"aria-label":"close",onClick:y,sx:{position:"absolute",right:8,top:8,color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.2)"}},children:e.jsx(ae,{})})]}),e.jsx(J,{dividers:!0,sx:{p:3},children:e.jsx(ht,{onProductMade:R})})]}),e.jsx(xt,{open:m,onClose:()=>b(!1)})]})};export{wt as default};
