import{i as X,j as e,s as G,T as m,M as F,a1 as se,a6 as le,f as o,B as S,e as A,I as L,A as Z,o as H,q as J,r as Q,a0 as u,a7 as Oe,t as qe,$ as De,K as Fe,N as je,P as ie,v as ze,D as ge,p as Ee,Z as Ne}from"./mui-051d3b2b.js";import{r as a}from"./vendor-0625b040.js";import{d as ae}from"./Close-5fff7674.js";import{r as ee,A as w,d as Te}from"./index-06d060e6.js";import{d as Ue}from"./Inventory-b46826e9.js";import{d as ve,a as Le}from"./MoreVert-f8e689fd.js";import{d as Be,a as Ve}from"./Archive-52c9146e.js";import{d as Ge}from"./Search-4e890fc8.js";import"./utils-f1b31201.js";var ce={},He=X;Object.defineProperty(ce,"__esModule",{value:!0});var de=ce.default=void 0,Je=He(ee()),ne=e;de=ce.default=(0,Je.default)([(0,ne.jsx)("path",{fillRule:"evenodd",d:"M16.67 13.13C18.04 14.06 19 15.32 19 17v3h4v-3c0-2.18-3.57-3.47-6.33-3.87"},"0"),(0,ne.jsx)("circle",{cx:"9",cy:"8",r:"4",fillRule:"evenodd"},"1"),(0,ne.jsx)("path",{fillRule:"evenodd",d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4c-.47 0-.91.1-1.33.24C14.5 5.27 15 6.58 15 8s-.5 2.73-1.33 3.76c.42.14.86.24 1.33.24m-6 1c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"},"2")],"PeopleAlt");var ue={},Qe=X;Object.defineProperty(ue,"__esModule",{value:!0});var be=ue.default=void 0,Ye=Qe(ee()),Ke=e;be=ue.default=(0,Ye.default)((0,Ke.jsx)("path",{d:"m22.7 19-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4"}),"Build");var he={},Ze=X;Object.defineProperty(he,"__esModule",{value:!0});var ye=he.default=void 0,Xe=Ze(ee()),et=e;ye=he.default=(0,Xe.default)((0,et.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline");var xe={},tt=X;Object.defineProperty(xe,"__esModule",{value:!0});var _e=xe.default=void 0,rt=tt(ee()),at=e;_e=xe.default=(0,rt.default)((0,at.jsx)("path",{d:"M7 11v2h10v-2zm5-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"RemoveCircleOutline");const st=({onProductAdded:_})=>{const[g,p]=a.useState({product_name:"",quantity:0,selling_price:0,category:""}),[b,W]=a.useState([]),[t,C]=a.useState([{materialId:"",measurement:"",unit:"",saved:!1}]),[M,P]=a.useState(0),[h,$]=a.useState(null),[k,y]=a.useState(null),R=["Fashion Accessories","Corporate Gifts","African print-inspired custom clothing"],j={"& .MuiInputBase-input":{fontWeight:"bold"},"& .MuiInputLabel-root":{fontWeight:"bold"}};a.useEffect(()=>{fetch(`${w}/api/material/all`,{credentials:"include"}).then(r=>r.json()).then(r=>W(r)).catch(r=>console.error("Error fetching materials for ProductForm:",r))},[]);const I=r=>{const{name:l,value:x}=r.target;p(N=>({...N,[l]:x}))},U=(r,l)=>{const{name:x,value:N}=l.target,n=[...t];if(n[r][x]=N,x==="materialId"){const d=b.find(f=>f.material_id===N);d&&(n[r].unit=d.unit)}(x==="measurement"||x==="materialId")&&(n[r].saved=!1),C(n)},O=()=>{C([...t,{materialId:"",measurement:"",unit:"",saved:!1}])},E=r=>{const l=[...t];l.splice(r,1),C(l),P(0)},q=r=>{const l=[...t];l[r].saved=!0,C(l)},z=()=>{let r=0;t.forEach(l=>{if(l.materialId&&l.measurement>0){const x=b.find(N=>N.material_id===l.materialId);x&&x.unit_price&&(r+=parseFloat(x.unit_price)*parseFloat(l.measurement))}}),P(r)};a.useEffect(()=>{z()},[t,b]);const s=()=>t.filter(r=>r.materialId&&r.measurement).map(r=>{const l=b.find(x=>x.material_id===r.materialId);return{material_id:r.materialId,measurement:parseFloat(r.measurement),unit:l?l.unit:"",unit_price:l?parseFloat(l.unit_price):0}}),i=async r=>{r.preventDefault();const l=new FormData;l.append("product_name",g.product_name),l.append("category",g.category),l.append("cost_of_production",M),l.append("selling_price",g.selling_price),l.append("quantity",g.quantity||0),l.append("materials",JSON.stringify(s())),k&&l.append("image",k);try{(await fetch(`${w}/api/products/add`,{method:"POST",body:l,credentials:"include"})).ok?($({type:"success",text:"Product added successfully!"}),p({product_name:"",selling_price:0,category:"",quantity:0}),C([{materialId:"",measurement:"",unit:"",saved:!1}]),P(0),y(null),_&&_()):$({type:"error",text:"Failed to add product."})}catch{$({type:"error",text:"Error adding product."})}};return e.jsx("form",{onSubmit:i,children:e.jsxs(G,{spacing:3,children:[" ",e.jsx(m,{label:"Product Name",name:"product_name",fullWidth:!0,required:!0,value:g.product_name,onChange:I,sx:j}),e.jsx(m,{select:!0,label:"Category",name:"category",fullWidth:!0,required:!0,value:g.category,onChange:I,sx:j,children:R.map(r=>e.jsx(F,{value:r,children:r},r))}),e.jsx(se,{variant:"outlined",sx:{p:2},children:e.jsxs(le,{children:[e.jsx(o,{variant:"subtitle1",gutterBottom:!0,children:"Material Used and Measurements"}),t.map((r,l)=>e.jsxs(S,{sx:{display:"flex",alignItems:"center",mb:2,gap:1},children:[e.jsx(m,{select:!0,label:"Material",name:"materialId",value:r.materialId,onChange:x=>U(l,x),sx:{flexGrow:1,...j},required:!0,children:b.length>0?b.map(x=>e.jsxs(F,{value:x.material_id,children:[x.material_name," (",x.unit,")"]},x.material_id)):e.jsx(F,{disabled:!0,children:"No materials found"})}),e.jsx(m,{label:"Measurement",name:"measurement",type:"number",value:r.measurement,onChange:x=>U(l,x),inputProps:{min:0,step:"any"},sx:{width:180,...j},required:!0}),e.jsx(m,{label:"Unit",name:"unit",value:r.unit,sx:{width:100,...j},InputProps:{readOnly:!0},disabled:!0}),e.jsx(A,{variant:r.saved?"outlined":"contained",size:"small",onClick:()=>q(l),disabled:!r.materialId||r.measurement<=0,children:r.saved?"Saved":"Save"}),t.length>1&&e.jsx(L,{color:"error",onClick:()=>E(l),"aria-label":"remove material line",children:e.jsx(_e,{})})]},l)),e.jsx(A,{variant:"text",startIcon:e.jsx(ye,{}),onClick:O,sx:{mt:1},children:"Add another material"})]})}),e.jsx(m,{label:"Quantity (Initial stock - will change when products are made)",name:"quantity",type:"number",fullWidth:!0,disabled:!0,value:g.quantity,onChange:I,inputProps:{min:0,step:"1"}}),e.jsx(S,{sx:{border:"1px solid #ccc",p:2,borderRadius:"4px",mt:2},children:e.jsxs(o,{variant:"h6",sx:{fontWeight:"bold"},children:["Cost of Production: R",M.toFixed(2)]})}),e.jsx(m,{label:"Selling Price",name:"selling_price",type:"number",fullWidth:!0,required:!0,value:g.selling_price,onChange:I,inputProps:{min:0,step:"0.01"},sx:j}),e.jsx(m,{type:"file",onChange:r=>y(r.target.files[0]),inputProps:{accept:"image/*"}}),h&&e.jsx(Z,{severity:h.type,children:h.text}),e.jsx(A,{variant:"contained",type:"submit",size:"large",children:"Add Product"})]})})};var pe={},it=X;Object.defineProperty(pe,"__esModule",{value:!0});var oe=pe.default=void 0,nt=it(ee()),ot=e;oe=pe.default=(0,nt.default)((0,ot.jsx)("path",{d:"m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8z"}),"ArrowUpward");var me={},lt=X;Object.defineProperty(me,"__esModule",{value:!0});var Se=me.default=void 0,ct=lt(ee()),dt=e;Se=me.default=(0,ct.default)((0,dt.jsx)("path",{d:"m20 12-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8z"}),"ArrowDownward");const ut=({open:_,onClose:g,product:p,onUpdate:b,productMaterials:W})=>{const[t,C]=a.useState({product_name:"",category:"",selling_price:0}),[M,P]=a.useState(0),[h,$]=a.useState(0),[k,y]=a.useState(!1),[R,j]=a.useState([]),[I,U]=a.useState([]),[O,E]=a.useState(null),[q,z]=a.useState(null),s=["Fashion Accessories","Corporate Gifts","African print-inspired custom clothing"];a.useEffect(()=>{if(p&&_){C({product_name:p.product_name||"",category:p.category||"",selling_price:Number(p.selling_price)||0});const n=Number(p.cost_of_production)||0;if(P(n),$(n),y(!1),Array.isArray(W)&&W.length>0){const d=W.map(f=>({id:f.material_id,materialId:f.material_id,measurement:Number(f.measurement)||0,unit:f.unit||"",material_name:f.material_name||"",unit_price:f.unit_price||"",saved:!0}));j(d)}else i(p.product_id)}},[p,_,W]),a.useEffect(()=>{_&&fetch(`${w}/api/material/all`,{credentials:"include"}).then(n=>n.json()).then(n=>U(n)).catch(n=>console.error("Error fetching materials:",n))},[_]);const i=async n=>{try{const d=await fetch(`${w}/api/products/${n}/materials`,{credentials:"include"});if(!d.ok){console.warn(`Materials endpoint returned ${d.status}, using default material`),j([{materialId:"",measurement:"",unit:"",saved:!1}]);return}const f=await d.json();if(console.log("Fetched materials:",f),f&&f.length>0){const D=f.map(B=>({id:B.material_id,materialId:B.material_id,measurement:Number(B.measurement)||0,unit:B.unit||"",saved:!0}));j(D)}else j([{materialId:"",measurement:"",unit:"",saved:!1}])}catch(d){console.error("Error fetching product materials:",d),j([{materialId:"",measurement:"",unit:"",saved:!1}])}},r=n=>{const{name:d,value:f}=n.target;C(D=>({...D,[d]:f}))},l=()=>{if(!k){P(h);return}let n=0;R.forEach(d=>{if(d.materialId&&d.measurement>0){const f=I.find(D=>D.material_id===d.materialId);if(f&&f.unit_price){const D=Number(f.unit_price)||0,B=Number(d.measurement)||0;n+=D*B}}}),P(n)};a.useEffect(()=>{l()},[R,I,k,h]);const x=()=>R.filter(n=>n.materialId&&n.measurement).map(n=>{const d=I.find(f=>f.material_id===n.materialId);return{id:n.material_id||null,materialId:n.materialId,measurement:parseFloat(n.measurement),unit:d?d.unit:""}}),N=async n=>{if(n.preventDefault(),!p||!p.product_id){z({type:"error",text:"Product ID is missing. Cannot update."});return}const d=new FormData;d.append("product_name",t.product_name),d.append("category",t.category),d.append("cost_of_production",Number(M)||0),d.append("selling_price",Number(t.selling_price)||0),d.append("materials_modified",k.toString()),d.append("materials",JSON.stringify(x())),O&&d.append("image",O);try{const f=await fetch(`${w}/api/products/${p.product_id}`,{method:"PUT",body:d,credentials:"include"}),D=await f.json();f.ok?(z({type:"success",text:"Product updated successfully!"}),setTimeout(()=>{b(),g()},1500)):z({type:"error",text:D.message||"Failed to update product."})}catch(f){console.error("Error:",f),z({type:"error",text:"Server error"})}};return e.jsxs(H,{open:_,onClose:g,maxWidth:"md",fullWidth:!0,children:[e.jsxs(J,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{children:["Update Product: ",p==null?void 0:p.product_name]}),e.jsx(L,{"aria-label":"close",onClick:g,size:"small",children:e.jsx("span",{"aria-hidden":"true",children:"Ã—"})})]}),e.jsxs("form",{onSubmit:N,children:[e.jsx(Q,{children:e.jsxs(G,{spacing:3,children:[e.jsx(m,{label:"Product Name",name:"product_name",fullWidth:!0,required:!0,value:t.product_name,onChange:r}),e.jsx(m,{select:!0,label:"Category",name:"category",fullWidth:!0,required:!0,value:t.category,onChange:r,children:s.map(n=>e.jsx(F,{value:n,children:n},n))}),e.jsx(se,{variant:"outlined",children:e.jsxs(le,{children:[e.jsxs(o,{variant:"subtitle1",gutterBottom:!0,children:["Material Used and Measurements",k&&e.jsx(o,{variant:"caption",color:"primary",sx:{ml:1},children:"(Modified - cost will be recalculated)"})]}),R.length===0?e.jsx(o,{color:"text.secondary",sx:{mb:2},children:"No materials found for this product."}):e.jsxs(S,{sx:{mb:2,bgcolor:"#f5f7fa",borderRadius:3,p:2,boxShadow:1},children:[e.jsxs(u,{container:!0,spacing:2,sx:{mb:1},children:[e.jsx(u,{item:!0,xs:5,children:e.jsx(o,{sx:{fontWeight:600},children:"Material"})}),e.jsx(u,{item:!0,xs:3,children:e.jsx(o,{sx:{fontWeight:600},children:"Measurement"})}),e.jsx(u,{item:!0,xs:2,children:e.jsx(o,{sx:{fontWeight:600},children:"Unit"})}),e.jsx(u,{item:!0,xs:2,children:e.jsx(o,{sx:{fontWeight:600},children:"Unit Price"})})]}),R.map((n,d)=>e.jsxs(u,{container:!0,spacing:2,alignItems:"center",sx:{mb:1,bgcolor:"#fff",borderRadius:2,p:1,border:"1px solid #e0e0e0"},children:[e.jsx(u,{item:!0,xs:5,children:e.jsx(m,{value:n.material_name,label:"Material",InputProps:{readOnly:!0},fullWidth:!0})}),e.jsx(u,{item:!0,xs:3,children:e.jsx(m,{value:n.measurement,label:"Measurement",InputProps:{readOnly:!0},fullWidth:!0})}),e.jsx(u,{item:!0,xs:2,children:e.jsx(m,{value:n.unit,label:"Unit",InputProps:{readOnly:!0},fullWidth:!0})}),e.jsx(u,{item:!0,xs:2,children:e.jsx(m,{value:n.unit_price,label:"Unit Price",InputProps:{readOnly:!0,startAdornment:e.jsx(o,{sx:{mr:1},children:"R"})},fullWidth:!0})})]},d))]})]})}),e.jsxs(S,{sx:{border:"1px solid #ccc",p:2,borderRadius:"4px",backgroundColor:k?"#e3f2fd":"#f5f5f5"},children:[e.jsxs(o,{variant:"h6",sx:{fontWeight:"bold",color:"text.secondary"},children:["Cost of Production: R",(Number(M)||0).toFixed(2)]}),e.jsx(o,{variant:"caption",color:"text.secondary",children:k?"* Recalculated from modified materials":"* Original cost (materials unchanged)"})]}),e.jsx(m,{label:"Selling Price",name:"selling_price",type:"number",fullWidth:!0,required:!0,value:t.selling_price,InputProps:{readOnly:!0},sx:{bgcolor:"#f5f5f5",fontWeight:600}}),e.jsxs(S,{sx:{border:"1px solid #ccc",p:2,borderRadius:"4px",backgroundColor:"#f5f5f5"},children:[e.jsxs(o,{variant:"body1",sx:{fontWeight:"bold",color:"text.secondary"},children:["Current Quantity: ",Number(p==null?void 0:p.quantity)||0]}),e.jsx(o,{variant:"caption",color:"text.secondary",children:"* Managed by manufacturing/sales processes (read-only)"})]}),e.jsx(m,{type:"file",onChange:n=>E(n.target.files[0]),helperText:"Upload new image (optional)"}),q&&e.jsx(Z,{severity:q.type,children:q.text})]})}),e.jsxs(Oe,{children:[e.jsx(A,{onClick:g,children:"Cancel"}),e.jsx(A,{type:"submit",variant:"contained",children:"Update Product"})]})]})]})},ht=({refreshTrigger:_})=>{const[g,p]=a.useState([]),[b,W]=a.useState(!0),[t,C]=a.useState(null),[M,P]=a.useState(null),[h,$]=a.useState(null),[k,y]=a.useState([]),[R,j]=a.useState([]),[I,U]=a.useState("product_name"),[O,E]=a.useState(""),[q,z]=a.useState(!1),[s,i]=a.useState(!1),[r,l]=a.useState(!1),[x,N]=a.useState("active"),[n,d]=a.useState(""),f=c=>{if(!c)return"/images/products/placeholder.png";const v=c.replace(/^\/images\/products\//,"");return`${w}/images/products/${v}`},D=async()=>{try{W(!0),C(null);let c=`${w}/api/products/all`;x&&(c+=`?status=${encodeURIComponent(x)}`);const v=await fetch(c,{credentials:"include"});if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);const V=await v.json();V.success&&Array.isArray(V.data)?p(V.data):Array.isArray(V)?p(V):(C("Invalid response format from server"),p([]))}catch(c){C(c.message),p([])}finally{W(!1)}};a.useEffect(()=>{D(),fetch(`${w}/api/material/all`,{credentials:"include"}).then(c=>c.json()).then(c=>{Array.isArray(c)?j(c):c.data&&Array.isArray(c.data)?j(c.data):j([])}).catch(()=>j([]))},[x]),a.useEffect(()=>{_&&D()},[_]);const B=Array.isArray(g)?g.filter(c=>{if(!c)return!1;const v=O.toLowerCase();return v?I==="product_name"?c.product_name&&c.product_name.toLowerCase().includes(v):I==="category"?c.category&&c.category.toLowerCase().includes(v):!0:!0}):[],Ce=async(c,v)=>{if(P(c.currentTarget),$(v),v!=null&&v.product_id)try{const T=await(await fetch(`${w}/api/products/${v.product_id}/materials`,{credentials:"include"})).json();if(T.success&&Array.isArray(T.data)){const $e=T.data.map(te=>{const K=R.find(Re=>Re.material_id===te.material_id);return{...te,material_name:K?K.material_name:te.material_name,unit_price:K?K.unit_price:te.unit_price,unit:K?K.unit:te.unit}});y($e)}else y([])}catch{y([])}else y([])},fe=c=>{N(c),E("")},Pe=()=>{i(!0),re()},we=()=>{l(!0),re()},ke=async()=>{if(h){try{(await fetch(`${w}/api/products/${h.product_id}/archive`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?(d("Product archived successfully"),D()):d("Failed to archive product")}catch{d("Network error")}i(!1),$(null)}},Ie=async()=>{if(h){try{(await fetch(`${w}/api/products/${h.product_id}/restore`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?(d("Product restored successfully"),D()):d("Failed to restore product")}catch{d("Network error")}l(!1),$(null)}},We=c=>{c.preventDefault()},re=()=>{P(null)},Ae=()=>{z(!0),re()},Me=()=>{D(),z(!1),$(null),y([])},Y={};return B.forEach(c=>{!c||!c.category||(Y[c.category]||(Y[c.category]=[]),Y[c.category].push(c))}),e.jsxs(e.Fragment,{children:[n&&e.jsx(Z,{severity:"success",sx:{mb:2},onClose:()=>d(""),children:n}),e.jsxs(S,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(A,{variant:x==="active"?"contained":"outlined",onClick:()=>fe("active"),size:"small",children:"Active Products"}),e.jsx(A,{variant:x==="archived"?"contained":"outlined",onClick:()=>fe("archived"),color:"warning",size:"small",children:"Archived Products"})]}),e.jsxs(S,{sx:{display:"flex",alignItems:"center",mb:2,gap:2},children:[e.jsxs(qe,{value:I,onChange:c=>U(c.target.value),size:"small",sx:{minWidth:140},children:[e.jsx(F,{value:"product_name",children:"Product Name"}),e.jsx(F,{value:"category",children:"Category"})]}),e.jsx("form",{onSubmit:We,style:{flex:1},children:e.jsx(m,{size:"small",placeholder:`Search by ${I.replace("_"," ")}`,value:O,onChange:c=>E(c.target.value),InputProps:{endAdornment:e.jsx(De,{position:"end",children:e.jsx(L,{type:"submit",size:"small",children:e.jsx(Ge,{})})})},fullWidth:!0})})]}),Object.keys(Y).length===0?e.jsx(o,{variant:"body1",sx:{mt:2,textAlign:"center"},children:x==="archived"?"No archived products found.":"No products found."}):Object.keys(Y).map(c=>e.jsxs(S,{sx:{mb:4},children:[e.jsx(o,{variant:"h5",sx:{fontWeight:700,mb:2,color:"primary.main"},children:c}),e.jsx(u,{container:!0,spacing:3,children:Y[c].map(v=>{const V=f(v.image_path);return e.jsx(u,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(se,{elevation:2,sx:{borderRadius:4,p:2,height:220,minWidth:180,maxWidth:260,boxShadow:"0 2px 8px rgba(0,0,0,0.08)",position:"relative",background:"#fff",opacity:v.status==="archived"?.7:1,border:v.status==="archived"?"2px dashed #ff9800":"2px solid #ff9800",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",transition:"border-color 0.2s","&:hover":{borderColor:"#1565c0",boxShadow:"0 4px 16px rgba(25, 118, 210, 0.15)"}},children:[e.jsxs(S,{sx:{position:"absolute",top:8,right:12,display:"flex",alignItems:"center",gap:.5},children:[e.jsxs(o,{variant:"body2",sx:{fontWeight:500,color:"grey.700",fontSize:14},children:["Qty : ",v.quantity||0]}),(()=>{const T=Number(v.quantity)||0;return T<10?e.jsx(Se,{sx:{color:"red",fontSize:18,ml:.5}}):T>=10&&T<=30?e.jsx(oe,{sx:{color:"red",fontSize:18,ml:.5}}):T>30?e.jsx(oe,{sx:{color:"green",fontSize:18,ml:.5}}):null})()]}),e.jsx(S,{sx:{mt:2,mb:1,display:"flex",justifyContent:"center",width:"100%"},children:e.jsx(Fe,{variant:"square",src:V,sx:{width:64,height:64,borderRadius:2,boxShadow:1},onError:T=>{T.target.src="/images/products/placeholder.png"}})}),e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600,textAlign:"center",mt:1,mb:.5,fontSize:16},children:v.product_name||"Unnamed Product"}),e.jsx(S,{sx:{position:"absolute",left:12,bottom:12},children:e.jsxs(o,{variant:"body1",sx:{fontWeight:700,color:"primary.main",fontSize:18},children:["R",v.selling_price?Number(v.selling_price).toFixed(2):"0.00"]})}),e.jsx(S,{sx:{position:"absolute",right:8,bottom:8},children:e.jsx(L,{onClick:T=>Ce(T,v),size:"small",children:e.jsx(ve,{})})})]})},v.product_id)})})]},c)),e.jsx(ut,{open:q,product:h,productMaterials:k,onUpdate:Me}),e.jsx(je,{anchorEl:M,open:!!M,onClose:re,children:h&&h.status==="active"?[e.jsxs(F,{onClick:Ae,sx:{color:"primary.main"},children:[e.jsx(Le,{sx:{mr:1,color:"#1976d2"},fontSize:"small"}),"Update"]},"update"),e.jsxs(F,{onClick:Pe,sx:{color:"error.main"},children:[e.jsx(Be,{sx:{mr:1,color:"#d32f2f"},fontSize:"small"}),"Archive"]},"archive")]:[e.jsxs(F,{onClick:we,sx:{color:"success.main"},children:[e.jsx(Ve,{sx:{mr:1,color:"#388e3c"},fontSize:"small"}),"Restore"]},"restore")]}),e.jsxs(H,{open:s,onClose:()=>i(!1),children:[e.jsx(J,{children:"Archive Product"}),e.jsxs(Q,{children:[e.jsxs(o,{sx:{mb:2},children:["Are you sure you want to archive ",e.jsx("b",{children:h==null?void 0:h.product_name}),"?"]}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"This will:"}),e.jsxs(o,{variant:"body2",component:"ul",sx:{pl:2},children:[e.jsx("li",{children:"Hide the product from searches and sales"}),e.jsx("li",{children:"Prevent new products from being made or bought"}),e.jsx("li",{children:"Change the status to archived"}),e.jsx("li",{children:"Product can be restored later if needed"})]}),e.jsxs(G,{direction:"row",spacing:2,sx:{mt:3,justifyContent:"flex-end"},children:[e.jsx(A,{onClick:()=>i(!1),children:"Cancel"}),e.jsx(A,{onClick:ke,color:"error",variant:"contained",children:"Archive Product"})]})]})]}),e.jsxs(H,{open:r,onClose:()=>l(!1),children:[e.jsx(J,{children:"Restore Product"}),e.jsxs(Q,{children:[e.jsxs(o,{sx:{mb:2},children:["Are you sure you want to restore ",e.jsx("b",{children:h==null?void 0:h.product_name}),"?"]}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"This will:"}),e.jsxs(o,{variant:"body2",component:"ul",sx:{pl:2},children:[e.jsx("li",{children:"Make the product available for searches and sales"}),e.jsx("li",{children:"Allow new products to be made or bought"}),e.jsx("li",{children:"Change the status to active"})]}),e.jsxs(G,{direction:"row",spacing:2,sx:{mt:3,justifyContent:"flex-end"},children:[e.jsx(A,{onClick:()=>l(!1),children:"Cancel"}),e.jsx(A,{onClick:Ie,color:"success",variant:"contained",children:"Restore Product"})]})]})]})]})},xt=({onProductMade:_})=>{const[g,p]=a.useState([]),[b,W]=a.useState([]),[t,C]=a.useState({product_id:"",method:"",quantity:"",production_date:"",provider_id:"",service_cost:""}),[M,P]=a.useState("0.00"),[h,$]=a.useState(!0),[k,y]=a.useState(""),[R,j]=a.useState(""),[I,U]=a.useState([]),[O,E]=a.useState(0);a.useEffect(()=>{fetch(`${w}/api/service-providers`,{credentials:"include"}).then(s=>s.json()).then(s=>U(s.data||[])).catch(()=>U([]))},[]),a.useEffect(()=>{fetch(`${w}/api/products/all`,{credentials:"include"}).then(s=>s.json()).then(s=>p(s.data||[])).catch(()=>p([])).finally(()=>$(!1))},[]),a.useEffect(()=>{t.product_id&&t.method==="scratch"?(console.log("ðŸ” Fetching materials for product:",t.product_id),fetch(`${w}/api/products/${t.product_id}/materials`,{credentials:"include"}).then(s=>s.json()).then(s=>{console.log("ðŸ“¦ Materials API response:",s),W(s.data||[])}).catch(s=>{console.error("âŒ Error fetching materials:",s),W([])})):W([])},[t.product_id,t.method]),a.useEffect(()=>{t.product_id?fetch(`${w}/api/products/${t.product_id}`,{credentials:"include"}).then(s=>s.json()).then(s=>{var i;E(((i=s.data)==null?void 0:i.cost_of_production)||0)}).catch(()=>E(0)):E(0)},[t.product_id]),a.useEffect(()=>{t.method==="scratch"&&t.quantity?P((parseFloat(O)*parseInt(t.quantity)).toFixed(2)):t.method==="provider"&&t.service_cost&&t.quantity?P((parseFloat(t.service_cost)*parseInt(t.quantity)).toFixed(2)):P("0.00")},[t.quantity,t.method,O,t.service_cost]);const q=s=>{const{name:i,value:r}=s.target;C(l=>({...l,[i]:r}))},z=async()=>{if(!t.method){y("Please select a production method."),setTimeout(()=>y(""),3e3);return}try{const s={product_id:t.product_id,production_method:t.method,quantity:parseInt(t.quantity),production_date:t.production_date,total_cost:parseFloat(M),materials_used:t.method==="scratch"?b.map(r=>({material_id:r.material_id,measurement:r.measurement,unit:r.unit,unit_price:r.unit_price})):[],provider_id:t.method==="provider"?t.provider_id:null,cost_of_production:t.method==="provider"?parseFloat(t.service_cost):parseFloat(O)};console.log("Submitting production payload:",s);const i=await fetch(`${w}/api/production`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(i.ok)j("Product manufacturing record created successfully!"),C({product_id:"",method:"",quantity:"",production_date:"",provider_id:"",service_cost:""}),W([]),setTimeout(()=>j(""),3e3),_&&_();else{const r=await i.json();y(r.message||"Failed to create production record"),setTimeout(()=>y(""),3e3)}}catch{y("Error submitting form"),setTimeout(()=>y(""),3e3)}};return h?e.jsxs(ie,{elevation:4,sx:{p:5,maxWidth:600,mx:"auto",mt:6,borderRadius:4,bgcolor:"#f8fafc"},children:[e.jsx(o,{variant:"h4",align:"center",sx:{mb:3,fontWeight:700},children:"Make Product"}),e.jsx(o,{children:"Loading products..."})]}):e.jsxs(ie,{elevation:4,sx:{p:5,maxWidth:600,mx:"auto",mt:6,borderRadius:4,bgcolor:"#f8fafc"},children:[e.jsx(o,{variant:"h4",align:"center",sx:{mb:3,fontWeight:700},children:"Make Product"}),k&&e.jsx(Z,{severity:"error",sx:{mb:2},children:k}),R&&e.jsx(Z,{severity:"success",sx:{mb:2},children:R}),e.jsxs(u,{container:!0,spacing:3,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(ze,{value:g.find(s=>s.product_id===t.product_id)||null,onChange:(s,i)=>{q({target:{name:"product_id",value:i?i.product_id:""}})},options:g,getOptionLabel:s=>s.product_name,isOptionEqualToValue:(s,i)=>s.product_id===i.product_id,renderInput:s=>e.jsx(m,{...s,label:"Product Name",placeholder:"Search products...",required:!0,size:"large",sx:{fontSize:20}}),renderOption:(s,i)=>a.createElement("li",{...s,key:i.product_id},i.product_name)})}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(m,{select:!0,fullWidth:!0,required:!0,label:"Production Method",name:"method",value:t.method,onChange:q,size:"large",children:[e.jsx(F,{value:"scratch",children:"Made from Scratch"}),e.jsx(F,{value:"provider",children:"Service Provider"})]})}),t.method==="scratch"&&e.jsx(u,{item:!0,xs:12,children:e.jsxs(S,{sx:{mt:2,mb:2},children:[e.jsx(ge,{sx:{mb:2}}),e.jsx(o,{variant:"h6",sx:{mb:2,fontWeight:700},children:"Materials Used"}),e.jsxs(u,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(u,{item:!0,xs:3,children:e.jsx(o,{sx:{fontWeight:600},children:"Material Name"})}),e.jsx(u,{item:!0,xs:3,children:e.jsx(o,{sx:{fontWeight:600},children:"Measurement"})}),e.jsx(u,{item:!0,xs:2,children:e.jsx(o,{sx:{fontWeight:600},children:"Unit"})}),e.jsx(u,{item:!0,xs:4,children:e.jsx(o,{sx:{fontWeight:600},children:"Unit Price"})})]}),b.length>0?b.map((s,i)=>e.jsxs(u,{container:!0,spacing:2,alignItems:"center",sx:{mb:1},children:[e.jsx(u,{item:!0,xs:3,children:e.jsx(m,{value:s.material_name,fullWidth:!0,InputProps:{readOnly:!0},variant:"outlined"})}),e.jsx(u,{item:!0,xs:3,children:e.jsx(m,{value:s.measurement,fullWidth:!0,InputProps:{readOnly:!0},variant:"outlined"})}),e.jsx(u,{item:!0,xs:2,children:e.jsx(m,{value:s.unit,fullWidth:!0,InputProps:{readOnly:!0},variant:"outlined"})}),e.jsx(u,{item:!0,xs:4,children:e.jsx(m,{value:s.unit_price,fullWidth:!0,InputProps:{readOnly:!0,startAdornment:e.jsx(o,{sx:{mr:1},children:"R"})},variant:"outlined"})})]},s.product_material_id||i)):e.jsx(o,{color:"text.secondary",sx:{mt:2},children:"No materials found for this product."}),e.jsx(m,{label:"Cost of Production (per unit)",value:O,fullWidth:!0,InputProps:{readOnly:!0},variant:"outlined",sx:{mt:2}})]})}),t.method==="provider"&&e.jsx(u,{item:!0,xs:12,children:e.jsxs(S,{sx:{mt:2,mb:2},children:[e.jsx(ge,{sx:{mb:2}}),e.jsx(o,{variant:"h6",sx:{mb:2,fontWeight:700},children:"Service Provider"}),e.jsxs(u,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(u,{item:!0,xs:6,children:e.jsx(m,{select:!0,label:"Service Provider Name",name:"provider_id",value:t.provider_id,onChange:q,fullWidth:!0,required:!0,children:I.map(s=>e.jsx(F,{value:s.provider_id,children:s.provider_name},s.provider_id))})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(m,{label:"Service Cost",name:"service_cost",type:"number",value:t.service_cost,onChange:q,fullWidth:!0,required:!0})})]})]})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(m,{fullWidth:!0,required:!0,label:"Quantity",name:"quantity",type:"number",value:t.quantity,onChange:q,size:"large",inputProps:{min:1}})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(m,{fullWidth:!0,required:!0,label:"Production Date",name:"production_date",type:"date",value:t.production_date,onChange:q,InputLabelProps:{shrink:!0},size:"large"})}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(ie,{sx:{p:2,bgcolor:"#e0f7fa",borderRadius:2,textAlign:"center",fontSize:22,fontWeight:600,color:"primary.main"},children:["Total Cost: R",M]})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(A,{variant:"contained",color:"primary",fullWidth:!0,size:"large",sx:{py:2,fontSize:18,fontWeight:700},disabled:!t.product_id||!t.method||!t.quantity||!t.production_date,onClick:z,children:"Make Product Stock"})})]})]})},pt=({open:_,onClose:g})=>{const[p,b]=a.useState([]),[W,t]=a.useState(!0),[C,M]=a.useState(null),[P,h]=a.useState(""),[$,k]=a.useState(null);a.useEffect(()=>{_&&(t(!0),fetch(`${w}/api/service-providers`,{credentials:"include"}).then(i=>i.json()).then(i=>{i.success&&Array.isArray(i.data)?b(i.data):b([]),t(!1)}).catch(()=>{b([]),t(!1),M("Failed to fetch service providers")}))},[_]);const[y,R]=a.useState(null),[j,I]=a.useState(!1);a.useEffect(()=>{_&&(t(!0),fetch(`${w}/api/service-providers`,{credentials:"include"}).then(i=>i.json()).then(i=>{i.success&&Array.isArray(i.data)?b(i.data):b([]),t(!1)}).catch(()=>{b([]),t(!1),M("Failed to fetch service providers")}))},[_,P]);const U=(i,r)=>{k(i.currentTarget),R(r)},O=()=>{k(null),R(null)},E=async()=>{if(y){try{(await fetch(`${w}/api/service-providers/${y.provider_id}/archive`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include"})).ok?h("Service provider archived"):h("Failed to archive")}catch{h("Network error")}O()}},q=()=>{h("Update not implemented"),O()},z=()=>{I(!0)},s=()=>{I(!1)};return e.jsxs(H,{open:_,onClose:g,fullScreen:!0,TransitionComponent:Ee,TransitionProps:{direction:"up"},children:[e.jsxs(J,{children:["Service Providers",e.jsx(L,{"aria-label":"close",onClick:g,sx:{position:"absolute",right:8,top:8,color:i=>i.palette.grey[500]},children:e.jsx(ae,{})})]}),e.jsxs(Q,{dividers:!0,children:[e.jsx(G,{direction:"row",justifyContent:"flex-end",sx:{mb:2},children:e.jsx(A,{variant:"contained",color:"warning",startIcon:e.jsx(de,{sx:{color:"#fff",fontSize:24}}),onClick:z,sx:{fontWeight:600,letterSpacing:1,fontSize:16,borderRadius:2},children:"Add New Service Provider"})}),P&&e.jsx(Z,{severity:"success",sx:{mb:2},onClose:()=>h(""),children:P}),W?e.jsx(o,{children:"Loading service providers..."}):C?e.jsx(o,{color:"error",children:C}):e.jsx(u,{container:!0,spacing:3,children:p.length===0?e.jsx(u,{item:!0,xs:12,children:e.jsx(o,{children:"No service providers found."})}):p.map(i=>e.jsx(u,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(se,{elevation:2,sx:{borderRadius:3,p:2,position:"relative"},children:[e.jsxs(le,{children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600},children:i.provider_name}),e.jsx(o,{variant:"body2",sx:{color:"text.secondary",mb:1},children:i.provider_location}),e.jsx(o,{variant:"body2",sx:{color:"text.secondary"},children:i.provider_email}),e.jsx(o,{variant:"body2",sx:{color:"text.secondary"},children:i.provider_number})]}),e.jsx(S,{sx:{position:"absolute",right:8,top:8},children:e.jsx(L,{onClick:r=>U(r,i),size:"small",children:e.jsx(ve,{})})})]})},i.provider_id))}),e.jsxs(H,{open:j,onClose:s,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(J,{children:["Add New Service Provider",e.jsx(L,{"aria-label":"close",onClick:s,sx:{position:"absolute",right:8,top:8,color:i=>i.palette.grey[500]},children:e.jsx(ae,{})})]}),e.jsx(Q,{dividers:!0,children:e.jsxs(S,{component:"form",sx:{display:"flex",flexDirection:"column",gap:2},onSubmit:async i=>{i.preventDefault();const r=new FormData(i.currentTarget),l=r.get("name"),x=r.get("location"),N=r.get("contact_number"),n=r.get("email");try{(await fetch(`${w}/api/service-providers`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:l,location:x,contact_number:N,email:n})})).ok?(h("Service provider added"),I(!1)):h("Failed to add service provider")}catch{h("Network error")}},children:[e.jsx(m,{name:"name",label:"Provider Name",required:!0,fullWidth:!0}),e.jsx(m,{name:"location",label:"Location",required:!0,fullWidth:!0}),e.jsx(m,{name:"contact_number",label:"Contact Number",required:!0,fullWidth:!0}),e.jsx(m,{name:"email",label:"Email",type:"email",required:!0,fullWidth:!0}),e.jsxs(G,{direction:"row",spacing:2,sx:{mt:2,justifyContent:"flex-end"},children:[e.jsx(A,{onClick:s,children:"Cancel"}),e.jsx(A,{type:"submit",variant:"contained",color:"warning",children:"Add Provider"})]})]})})]}),e.jsxs(je,{anchorEl:$,open:!!$,onClose:O,children:[e.jsx(F,{onClick:q,children:"Update"}),e.jsx(F,{onClick:E,sx:{color:"error.main"},children:"Archive"})]})]})]})},Ct=()=>{const[_,g]=a.useState(!1),[p,b]=a.useState(!1),[W,t]=a.useState(!1),[C,M]=a.useState(0),P=()=>{g(!0)},h=()=>{g(!1)},$=()=>{M(j=>j+1),g(!1)},k=()=>t(!0),y=()=>t(!1),R=()=>{M(j=>j+1),t(!1)};return e.jsxs(S,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",py:4,px:2},children:[e.jsxs(Ne,{maxWidth:"lg",children:[e.jsxs(S,{sx:{background:"white",borderRadius:4,p:4,mb:4,boxShadow:"0 20px 60px rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:3},children:[e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(S,{sx:{width:80,height:80,borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 8px 24px rgba(102, 126, 234, 0.4)"},children:e.jsx(Ue,{sx:{fontSize:40,color:"white"}})}),e.jsxs(S,{children:[e.jsx(o,{variant:"h3",sx:{fontWeight:800,letterSpacing:1,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textTransform:"uppercase"},children:"Product Management"}),e.jsx(o,{sx:{color:"text.secondary",fontSize:16,mt:.5,fontWeight:500},children:"ðŸŽ¨ Create, manage, and track your products"})]})]}),e.jsxs(G,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(A,{variant:"contained",startIcon:e.jsx(Te,{}),onClick:P,sx:{py:1.5,px:3,fontWeight:700,letterSpacing:1,fontSize:15,borderRadius:2,background:"linear-gradient(90deg, #1976d2 0%, #64b5f6 100%)",boxShadow:"0 4px 15px rgba(25, 118, 210, 0.4)",transition:"all 0.3s ease",textTransform:"none","&:hover":{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(25, 118, 210, 0.6)",background:"linear-gradient(90deg, #1565c0 0%, #42a5f5 100%)"}},children:"New Product"}),e.jsx(A,{variant:"contained",startIcon:e.jsx(be,{}),onClick:k,sx:{py:1.5,px:3,fontWeight:700,letterSpacing:1,fontSize:15,borderRadius:2,background:"linear-gradient(90deg, #9c27b0 0%, #ba68c8 100%)",boxShadow:"0 4px 15px rgba(156, 39, 176, 0.4)",transition:"all 0.3s ease",textTransform:"none","&:hover":{transform:"translateY(-2px)",boxShadow:"0 6px 20px rgba(156, 39, 176, 0.6)",background:"linear-gradient(90deg, #7b1fa2 0%, #ab47bc 100%)"}},children:"Make Products"}),e.jsx(A,{variant:"outlined",startIcon:e.jsx(de,{}),onClick:()=>b(!0),sx:{py:1.5,px:3,fontWeight:700,letterSpacing:1,fontSize:15,borderRadius:2,borderWidth:2,borderColor:"#ff9800",color:"#ff9800",textTransform:"none",transition:"all 0.3s ease","&:hover":{borderWidth:2,borderColor:"#f57c00",backgroundColor:"rgba(255, 152, 0, 0.1)",transform:"translateY(-2px)"}},children:"Service Providers"})]})]}),e.jsxs(S,{sx:{background:"white",borderRadius:4,p:4,boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsx(o,{variant:"h5",sx:{mb:3,fontWeight:700,color:"#667eea",letterSpacing:.5},children:"Product Catalog"}),e.jsx(ht,{refreshTrigger:C})]})]}),e.jsxs(H,{open:_,onClose:h,fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{borderRadius:3,boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},children:[e.jsxs(J,{sx:{m:0,p:3,background:"linear-gradient(135deg, #1976d2 0%, #64b5f6 100%)",color:"white",fontWeight:700,fontSize:20,letterSpacing:1},children:["Add New Product",e.jsx(L,{"aria-label":"close",onClick:h,sx:{position:"absolute",right:8,top:8,color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.2)"}},children:e.jsx(ae,{})})]}),e.jsx(Q,{dividers:!0,sx:{p:3},children:e.jsx(st,{onProductAdded:$})})]}),e.jsxs(H,{open:W,onClose:y,fullWidth:!0,maxWidth:"md",PaperProps:{sx:{borderRadius:3,boxShadow:"0 20px 60px rgba(0,0,0,0.3)"}},children:[e.jsxs(J,{sx:{m:0,p:3,background:"linear-gradient(135deg, #9c27b0 0%, #ba68c8 100%)",color:"white",fontWeight:700,fontSize:20,letterSpacing:1},children:["Make Product",e.jsx(L,{"aria-label":"close",onClick:y,sx:{position:"absolute",right:8,top:8,color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.2)"}},children:e.jsx(ae,{})})]}),e.jsx(Q,{dividers:!0,sx:{p:3},children:e.jsx(xt,{onProductMade:R})})]}),e.jsx(pt,{open:p,onClose:()=>b(!1)})]})};export{Ct as default};
