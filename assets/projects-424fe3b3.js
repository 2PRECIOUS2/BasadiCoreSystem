import{g as Ve,b as Ge,s as ve,_ as Y,r as c,e as Je,i as Ye,f as Qe,W as Xe,p as Ke,j as e,k as Ze,l as et,X as tt,Q as st,U as Pe,A as xe,B as i,T as o,q as Z,x as Ee,P as be,C as se,D as he,E as rt,G as at}from"./index-7f2a5a5c.js";import{G as h,C as ne}from"./Grid-bb9fb0fd.js";import{C as nt,d as it}from"./Delete-54772e0b.js";import{C as Re}from"./CardContent-7b61cd42.js";import{C as re}from"./Chip-e53104cd.js";import{M as Oe}from"./LinearProgress-076af29f.js";import{L as ot,a as lt}from"./lodash-052838f0.js";import{S as Ne}from"./Slide-81ab56a8.js";import{D as ye}from"./Dialog-b4e01f51.js";import{A as oe}from"./Avatar-c5f94f89.js";import{W as je,B as dt,T as ct,C as ut}from"./Work-e20e4d4e.js";import{I as ue,b as ie,L as xt}from"./MenuItem-e27c57ab.js";import{D as Q}from"./Divider-f09bd367.js";import{T as D}from"./TextField-b5c10dbe.js";import{F as le,I as de,S as ce,O as ht,A as Ce}from"./Select-d37c91fa.js";import{A as ze,S as ft}from"./Save-981fd805.js";import{A as qe}from"./Add-810ef412.js";import{M as pt}from"./ListItemText-44ba3285.js";import{C as mt}from"./CircularProgress-1de20e04.js";import{S as Se}from"./Snackbar-095d4b37.js";import{d as _e}from"./Add-d3225c7a.js";import{d as gt}from"./Close-8ea6b3d6.js";import{A as bt}from"./AppBar-d269a817.js";import{T as jt}from"./Toolbar-9e4b0934.js";import{M as vt}from"./Checkbox-7d491049.js";import{r as fe}from"./createSvgIcon-7d212144.js";import{d as yt}from"./ShoppingCart-b7f601da.js";import{T as Ct}from"./TableContainer-44a88e8c.js";import{T as St,a as kt,b as Me,c as It}from"./TableRow-0db546b8.js";import{T as K}from"./TableCell-c04f540f.js";import"./Popper-4ae086c2.js";import"./ClickAwayListener-abc824ad.js";function wt(u){return Ve("MuiCollapse",u)}Ge("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const Wt=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],Tt=u=>{const{orientation:a,classes:n}=u,d={root:["root",`${a}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${a}`],wrapperInner:["wrapperInner",`${a}`]};return et(d,wt,n)},Dt=ve("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(u,a)=>{const{ownerState:n}=u;return[a.root,a[n.orientation],n.state==="entered"&&a.entered,n.state==="exited"&&!n.in&&n.collapsedSize==="0px"&&a.hidden]}})(({theme:u,ownerState:a})=>Y({height:0,overflow:"hidden",transition:u.transitions.create("height")},a.orientation==="horizontal"&&{height:"auto",width:0,transition:u.transitions.create("width")},a.state==="entered"&&Y({height:"auto",overflow:"visible"},a.orientation==="horizontal"&&{width:"auto"}),a.state==="exited"&&!a.in&&a.collapsedSize==="0px"&&{visibility:"hidden"})),Pt=ve("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(u,a)=>a.wrapper})(({ownerState:u})=>Y({display:"flex",width:"100%"},u.orientation==="horizontal"&&{width:"auto",height:"100%"})),zt=ve("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(u,a)=>a.wrapperInner})(({ownerState:u})=>Y({width:"100%"},u.orientation==="horizontal"&&{width:"auto",height:"100%"})),Fe=c.forwardRef(function(a,n){const d=Je({props:a,name:"MuiCollapse"}),{addEndListener:I,children:f,className:w,collapsedSize:p="0px",component:C,easing:m,in:l,onEnter:v,onEntered:S,onEntering:O,onExit:N,onExited:U,onExiting:_,orientation:j="vertical",style:$,timeout:P=tt.standard,TransitionComponent:B=st}=d,M=Ye(d,Wt),W=Y({},d,{orientation:j,collapsedSize:p}),g=Tt(W),E=Qe(),k=Xe(),z=c.useRef(null),A=c.useRef(),T=typeof p=="number"?`${p}px`:p,y=j==="horizontal",L=y?"width":"height",R=c.useRef(null),V=Ke(n,R),q=t=>s=>{if(t){const r=R.current;s===void 0?t(r):t(r,s)}},X=()=>z.current?z.current[y?"clientWidth":"clientHeight"]:0,F=q((t,s)=>{z.current&&y&&(z.current.style.position="absolute"),t.style[L]=T,v&&v(t,s)}),ee=q((t,s)=>{const r=X();z.current&&y&&(z.current.style.position="");const{duration:b,easing:H}=Pe({style:$,timeout:P,easing:m},{mode:"enter"});if(P==="auto"){const De=E.transitions.getAutoHeightDuration(r);t.style.transitionDuration=`${De}ms`,A.current=De}else t.style.transitionDuration=typeof b=="string"?b:`${b}ms`;t.style[L]=`${r}px`,t.style.transitionTimingFunction=H,O&&O(t,s)}),ae=q((t,s)=>{t.style[L]="auto",S&&S(t,s)}),G=q(t=>{t.style[L]=`${X()}px`,N&&N(t)}),J=q(U),te=q(t=>{const s=X(),{duration:r,easing:b}=Pe({style:$,timeout:P,easing:m},{mode:"exit"});if(P==="auto"){const H=E.transitions.getAutoHeightDuration(s);t.style.transitionDuration=`${H}ms`,A.current=H}else t.style.transitionDuration=typeof r=="string"?r:`${r}ms`;t.style[L]=T,t.style.transitionTimingFunction=b,_&&_(t)}),x=t=>{P==="auto"&&k.start(A.current||0,t),I&&I(R.current,t)};return e.jsx(B,Y({in:l,onEnter:F,onEntered:ae,onEntering:ee,onExit:G,onExited:J,onExiting:te,addEndListener:x,nodeRef:R,timeout:P==="auto"?null:P},M,{children:(t,s)=>e.jsx(Dt,Y({as:C,className:Ze(g.root,w,{entered:g.entered,exited:!l&&T==="0px"&&g.hidden}[t]),style:Y({[y?"minWidth":"minHeight"]:T},$),ref:V},s,{ownerState:Y({},W,{state:t}),children:e.jsx(Pt,{ownerState:Y({},W,{state:t}),className:g.wrapper,ref:z,children:e.jsx(zt,{ownerState:Y({},W,{state:t}),className:g.wrapperInner,children:f})})}))}))});Fe.muiSupportAuto=!0;const _t=Fe,Mt=xe(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),$e=xe(e.jsx("path",{d:"M17 10H7v2h10zm2-7h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V8h14zm-5-5H7v2h7z"}),"EventNote"),$t=xe(e.jsx("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterList"),At=xe(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"Group"),Lt=xe(e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),Ae={training:"https://source.unsplash.com/400x200/?training,education",product:"https://source.unsplash.com/400x200/?product,launch",default:"https://source.unsplash.com/400x200/?project"};function Et(u){return Ae[u]||Ae.default}function Rt({projects:u,onEdit:a,onView:n}){return e.jsx(h,{container:!0,spacing:3,children:u.map(d=>{const I=new Date,f=new Date(d.start_date||d.startDate||d.startdate),w=d.totalTasks||(d.tasks?d.tasks.length:0),p=d.completedTasks!==void 0?d.completedTasks:d.tasks?d.tasks.filter(S=>S.completed).length:0,C=w>0?Math.round(p/w*100):0;let m="#e57373";C>75?m="#388e3c":C>50?m="#8bc34a":C>30&&(m="#ffa726");let l="Not Started";w>0&&(p===w?l="Completed":(p>0||I>=f)&&(l="In Progress"));let v="warning";return l==="Completed"?v="success":l==="Not Started"&&(v="default"),e.jsx(h,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(ne,{sx:{height:390,display:"flex",flexDirection:"column"},children:[e.jsx(nt,{component:"img",height:"140",image:d.image?d.image:Et(d.category),alt:d.category,sx:{objectFit:"cover"}}),e.jsxs(Re,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"space-between",minHeight:200},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(o,{variant:"h6",sx:{fontWeight:500,fontSize:20,lineHeight:1.2},children:d.title}),e.jsx(re,{label:l,color:v,size:"small"})]}),e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Completed Tasks: ",e.jsxs("b",{children:[p,"/",w]})]}),e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Deadline: ",e.jsx("b",{children:d.deadline?d.deadline.slice(0,10):""})]}),e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Location: ",e.jsx("b",{children:d.location})]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(Oe,{variant:"determinate",value:C,sx:{flexGrow:1,mr:1,height:10,borderRadius:5,backgroundColor:"#f5f5f5","& .MuiLinearProgress-bar1Determinate":{backgroundColor:m}}}),e.jsxs(o,{variant:"body2",children:[C,"%"]})]}),e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(Z,{size:"small",variant:"outlined",onClick:()=>n&&n(d),children:"View Details"}),e.jsx(Z,{size:"small",variant:"contained",onClick:()=>a&&a(d),children:"Edit Project Info"})]})]})]})},d.id)})})}const Ot=[{label:"Training Program",value:"training"},{label:"Handicraft Program",value:"handicraft"},{label:"Product Launching",value:"product"},{label:"Speaker Program",value:"speaker"}],Nt=Ee.forwardRef(function(a,n){return e.jsx(Ne,{direction:"up",ref:n,...a})});function qt({open:u,onClose:a,onSave:n}){const[d,I]=c.useState(""),[f,w]=c.useState(""),[p,C]=c.useState(""),[m,l]=c.useState(""),[v,S]=c.useState(""),[O,N]=c.useState(""),[U,_]=c.useState(""),[j,$]=c.useState([]),[P,B]=c.useState(!1),[M,W]=c.useState({open:!1,message:"",severity:"success"}),[g,E]=c.useState({}),[k,z]=c.useState([]),[A,T]=c.useState(""),[y,L]=c.useState([]),[R,V]=c.useState(""),[q,X]=c.useState(""),[F,ee]=c.useState([]);c.useEffect(()=>{u&&(async()=>{try{const s=await fetch(`${se}/api/projects/employees`,{credentials:"include"});if(s.ok){const r=await s.json();ee(Array.isArray(r)?r:[])}else console.warn("Failed to fetch staff list, using empty array"),ee([])}catch(s){console.warn("Error fetching staff list:",s),ee([])}})()},[u]);const ae=()=>{if(!A.trim()){W({open:!0,message:"Task name is required.",severity:"error"});return}if(!R){W({open:!0,message:"Task deadline is required.",severity:"error"});return}z([...k,{name:A,assignedStaff:y,deadline:R}]),T(""),L([]),V("")},G=t=>{z(k.filter((s,r)=>r!==t))},J=()=>{const t={};return d||(t.projectName="Project Name is required"),f||(t.category="Category is required"),p||(t.startDate="Start Date is required"),m||(t.deadline="Deadline is required"),v||(t.location="Location is required"),U||(t.description="Project description is required"),j.length===0&&(t.staffAssignment="At least one staff member must be assigned"),k.length===0&&(t.tasks="At least one project task is required"),p&&m&&p>m&&(t.deadline="Deadline cannot be before start date"),k.forEach((s,r)=>{s.deadline&&p&&s.deadline<p&&(t.tasks="Task deadlines cannot be before project start date"),s.deadline&&m&&s.deadline>m&&(t.tasks="Task deadlines cannot be after project deadline")}),E(t),Object.keys(t).length===0},te=async t=>{if(t.preventDefault(),!J()){W({open:!0,message:"Please fill in all required fields.",severity:"error"});return}B(!0);const s={projectName:d,category:f,startDate:p,deadline:m,location:v,partner:O,description:U,staff:j,tasks:k.map(r=>({name:r.name,staffId:r.assignedStaff.length>0?r.assignedStaff[0]:null,taskDeadline:r.deadline,completed:!1})),additionalNotes:q,status:"active"};try{const r=await fetch(`${se}/api/projects`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"});if(r.ok){const b=await r.json();W({open:!0,message:"Project created successfully!",severity:"success"}),x(),n&&n(b)}else{const b=await r.json();W({open:!0,message:b.message||"Failed to create project",severity:"error"})}}catch(r){console.error("Error creating project:",r),W({open:!0,message:"Network error. Please try again.",severity:"error"})}finally{B(!1)}},x=()=>{I(""),w(""),C(""),l(""),S(""),N(""),_(""),$([]),z([]),T(""),L([]),V(""),X(""),E({}),B(!1),a()};return e.jsx(ye,{fullScreen:!0,open:u,onClose:x,TransitionComponent:Nt,PaperProps:{sx:{backgroundColor:"#f8fafc",backgroundImage:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},children:e.jsxs("form",{onSubmit:te,children:[e.jsxs(i,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:[e.jsxs(i,{sx:{bgcolor:"rgba(255,255,255,0.95)",backdropFilter:"blur(10px)",borderBottom:"3px solid #667eea",p:3,display:"flex",alignItems:"center",justifyContent:"space-between",boxShadow:"0 4px 20px rgba(0,0,0,0.1)"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(oe,{sx:{bgcolor:"#667eea",width:56,height:56,boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)"},children:e.jsx(je,{sx:{fontSize:32,color:"white"}})}),e.jsxs(i,{children:[e.jsx(o,{variant:"h4",sx:{fontWeight:"bold",background:"linear-gradient(45deg, #667eea, #764ba2)",backgroundClip:"text",color:"transparent",mb:.5},children:"Create New Project"}),e.jsxs(o,{variant:"h6",sx:{color:"#64748b",display:"flex",alignItems:"center",gap:1},children:[e.jsx(dt,{sx:{fontSize:20}}),"Plan and organize your project workflow"]})]})]}),e.jsx(ct,{title:"Close",children:e.jsx(ue,{onClick:x,sx:{color:"#667eea","&:hover":{bgcolor:"rgba(102, 126, 234, 0.1)",transform:"scale(1.1)"}},children:e.jsx(ut,{sx:{fontSize:30}})})})]}),e.jsx(i,{sx:{flex:1,p:4,display:"flex",justifyContent:"center",alignItems:"flex-start"},children:e.jsxs(be,{sx:{maxWidth:1e3,width:"100%",p:4,borderRadius:3,background:"rgba(255,255,255,0.95)",backdropFilter:"blur(10px)",boxShadow:"0 20px 40px rgba(0,0,0,0.1)",border:"1px solid rgba(255,255,255,0.2)"},children:[e.jsxs(i,{sx:{mb:4},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx($e,{sx:{color:"#667eea",fontSize:28}}),e.jsx(o,{variant:"h6",sx:{fontWeight:"bold",color:"#2d3748"},children:"Project Details"})]}),e.jsx(Q,{sx:{mb:3,borderColor:"#667eea",borderWidth:1}}),e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(D,{label:"Project Name",value:d,onChange:t=>I(t.target.value),required:!0,fullWidth:!0,error:!!g.projectName,helperText:g.projectName,sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#667eea",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#667eea"}}})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsxs(le,{fullWidth:!0,error:!!g.category,children:[e.jsx(de,{children:"Project Category"}),e.jsx(ce,{value:f,label:"Project Category",onChange:t=>w(t.target.value),required:!0,sx:{"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#667eea",borderWidth:2},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#667eea",borderWidth:2}},children:Ot.map(t=>e.jsx(ie,{value:t.value,children:t.label},t.value))}),g.category&&e.jsx(o,{color:"error",variant:"caption",children:g.category})]})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(D,{label:"Start Date",type:"date",value:p,onChange:t=>C(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,required:!0,error:!!g.startDate,helperText:g.startDate,sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#48bb78",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#48bb78",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#48bb78"}}})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(D,{label:"Deadline",type:"date",value:m,onChange:t=>l(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,required:!0,error:!!g.deadline,helperText:g.deadline,inputProps:{min:p||void 0},sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#ed8936",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#ed8936",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#ed8936"}}})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(D,{label:"Location",value:v,onChange:t=>S(t.target.value),fullWidth:!0,required:!0,error:!!g.location,helperText:g.location,sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#805ad5",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#805ad5",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#805ad5"}}})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(D,{label:"Partner (Optional)",value:O,onChange:t=>N(t.target.value),fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#667eea",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#667eea"}}})})]})]}),e.jsxs(i,{sx:{mb:4},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(At,{sx:{color:"#667eea",fontSize:28}}),e.jsx(o,{variant:"h6",sx:{fontWeight:"bold",color:"#2d3748"},children:"Staff Assignment"})]}),e.jsx(Q,{sx:{mb:3,borderColor:"#667eea",borderWidth:1}}),e.jsxs(le,{fullWidth:!0,error:!!g.staffAssignment,children:[e.jsx(de,{children:"Assign Staff Members"}),e.jsx(ce,{multiple:!0,value:j,onChange:t=>$(t.target.value),required:!0,renderValue:t=>e.jsx(i,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(s=>{const r=F.find(H=>H.employee_id===s),b=r?`${r.first_name} ${r.last_name}`:s;return e.jsx(re,{label:b,size:"small",sx:{bgcolor:"#667eea",color:"white","& .MuiChip-deleteIcon":{color:"white"}}},s)})}),sx:{"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#667eea",borderWidth:2},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#667eea",borderWidth:2}},children:F.length===0?e.jsx(ie,{disabled:!0,children:e.jsx(o,{color:"textSecondary",children:u?"Loading staff members...":"No staff members available"})}):F.map(t=>{var s,r;return e.jsx(ie,{value:t.employee_id,children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(oe,{sx:{width:32,height:32,bgcolor:"#667eea"},children:[(s=t.first_name)==null?void 0:s.charAt(0),(r=t.last_name)==null?void 0:r.charAt(0)]}),e.jsxs(i,{children:[e.jsxs(o,{children:[t.first_name," ",t.last_name]}),e.jsx(o,{variant:"caption",color:"textSecondary",children:t.email})]})]})},t.employee_id)})}),g.staffAssignment&&e.jsx(o,{color:"error",variant:"caption",children:g.staffAssignment})]})]}),e.jsxs(i,{sx:{mb:4},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(ze,{sx:{color:"#667eea",fontSize:28}}),e.jsx(o,{variant:"h6",sx:{fontWeight:"bold",color:"#2d3748"},children:"Project Tasks"})]}),e.jsx(Q,{sx:{mb:3,borderColor:"#667eea",borderWidth:1}}),e.jsxs(i,{sx:{p:3,border:"1px solid #e2e8f0",borderRadius:2,mb:3,backgroundColor:"#f8fafc"},children:[e.jsx(o,{variant:"subtitle1",sx:{mb:2,fontWeight:"bold"},children:"Add New Task"}),e.jsxs(h,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(h,{item:!0,xs:12,sm:4,children:e.jsx(D,{label:"Task Name",value:A,onChange:t=>T(t.target.value),fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea"},"&.Mui-focused fieldset":{borderColor:"#667eea"}}}})}),e.jsx(h,{item:!0,xs:12,sm:3,children:e.jsxs(le,{fullWidth:!0,size:"small",children:[e.jsx(de,{children:"Assign Staff"}),e.jsx(ce,{multiple:!0,value:y,onChange:t=>L(t.target.value),input:e.jsx(ht,{label:"Assign Staff"}),renderValue:t=>e.jsx(i,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(s=>{const r=F.find(H=>H.employee_id===s),b=r?`${r.first_name} ${r.last_name}`:s;return e.jsx(re,{label:b,size:"small"},s)})}),children:F.length===0?e.jsx(ie,{disabled:!0,children:e.jsx(o,{color:"textSecondary",children:"No staff available"})}):F.map(t=>{var s,r;return e.jsx(ie,{value:t.employee_id,children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(oe,{sx:{width:24,height:24,bgcolor:"#667eea",fontSize:"0.75rem"},children:[(s=t.first_name)==null?void 0:s.charAt(0),(r=t.last_name)==null?void 0:r.charAt(0)]}),e.jsxs(o,{variant:"body2",children:[t.first_name," ",t.last_name]})]})},t.employee_id)})})]})}),e.jsx(h,{item:!0,xs:12,sm:3,children:e.jsx(D,{label:"Task Deadline",type:"date",value:R,onChange:t=>V(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,size:"small",inputProps:{min:p||void 0,max:m||void 0},sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea"},"&.Mui-focused fieldset":{borderColor:"#667eea"}}}})}),e.jsx(h,{item:!0,xs:12,sm:2,children:e.jsx(Z,{variant:"contained",onClick:ae,fullWidth:!0,startIcon:e.jsx(qe,{}),sx:{background:"linear-gradient(45deg, #667eea, #764ba2)","&:hover":{background:"linear-gradient(45deg, #5a67d8, #6b46c1)"}},children:"Add Task"})})]})]}),k.length>0&&e.jsxs(i,{sx:{border:"1px solid #e2e8f0",borderRadius:2,backgroundColor:"white"},children:[e.jsxs(o,{variant:"subtitle1",sx:{p:2,fontWeight:"bold",borderBottom:"1px solid #e2e8f0"},children:["Project Tasks (",k.length,")"]}),e.jsx(xt,{dense:!0,children:k.map((t,s)=>e.jsxs(ot,{divider:s<k.length-1,children:[e.jsx(pt,{primary:e.jsx(o,{variant:"body1",sx:{fontWeight:"medium"},children:t.name}),secondary:e.jsxs(i,{sx:{mt:1},children:[e.jsxs(o,{variant:"body2",color:"textSecondary",children:[e.jsx("strong",{children:"Assigned to:"})," ",t.assignedStaff.length>0?t.assignedStaff.map(r=>{const b=F.find(H=>H.employee_id===r);return b?`${b.first_name} ${b.last_name}`:r}).join(", "):"Unassigned"]}),e.jsxs(o,{variant:"body2",color:"textSecondary",children:[e.jsx("strong",{children:"Deadline:"})," ",t.deadline]})]})}),e.jsx(lt,{children:e.jsx(ue,{edge:"end",onClick:()=>G(s),color:"error",size:"small",children:e.jsx(Mt,{})})})]},s))})]})]}),e.jsxs(i,{sx:{mb:4},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(ze,{sx:{color:"#667eea",fontSize:28}}),e.jsx(o,{variant:"h6",sx:{fontWeight:"bold",color:"#2d3748"},children:"Project Description"})]}),e.jsx(Q,{sx:{mb:3,borderColor:"#667eea",borderWidth:1}}),e.jsx(D,{label:"Describe your project goals, requirements, and deliverables",value:U,onChange:t=>_(t.target.value),multiline:!0,rows:6,fullWidth:!0,required:!0,error:!!g.description,helperText:g.description,sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#667eea",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#667eea"}}})]}),e.jsxs(i,{sx:{mb:4},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx($e,{sx:{color:"#667eea",fontSize:28}}),e.jsx(o,{variant:"h6",sx:{fontWeight:"bold",color:"#2d3748"},children:"Additional Notes (Optional)"})]}),e.jsx(Q,{sx:{mb:3,borderColor:"#667eea",borderWidth:1}}),e.jsx(D,{label:"Any additional information, requirements, or special considerations",value:q,onChange:t=>X(t.target.value),multiline:!0,rows:3,fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#667eea",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#667eea"}}})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pt:3,borderTop:"2px solid #e2e8f0"},children:[e.jsx(Z,{onClick:x,variant:"outlined",size:"large",sx:{borderColor:"#94a3b8",color:"#64748b",px:4,py:1.5,"&:hover":{borderColor:"#64748b",backgroundColor:"rgba(100, 116, 139, 0.04)"}},children:"Cancel"}),e.jsx(Z,{type:"submit",variant:"contained",size:"large",disabled:P,startIcon:P?e.jsx(mt,{size:20}):e.jsx(ft,{}),sx:{background:"linear-gradient(45deg, #667eea, #764ba2)",color:"white",px:4,py:1.5,fontWeight:"bold","&:hover":{background:"linear-gradient(45deg, #5a67d8, #6b46c1)",transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(102, 126, 234, 0.3)"},"&:disabled":{background:"#94a3b8"}},children:P?"Creating...":"Create Project"})]})]})})]}),e.jsx(Se,{open:M.open,autoHideDuration:4e3,onClose:()=>W({...M,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(Ce,{onClose:()=>W({...M,open:!1}),severity:M.severity,sx:{width:"100%"},children:M.message})})]})})}const Ft=Ee.forwardRef(function(a,n){return e.jsx(Ne,{direction:"up",ref:n,...a})});function Ht({open:u,onClose:a,project:n,onSave:d}){const I=t=>{if(!t)return"";const s=typeof t=="string"?new Date(t):t;return isNaN(s)?"":s.toISOString().slice(0,10)},f=(t,s,r)=>t[s]!==void 0?t[s]:t[r]||"",w=t=>{if(!Array.isArray(t))return console.log("âš ï¸ normalizeTasks: tasksArr is not an array:",t),[];const s=t.map(r=>{console.log("ðŸ”„ Normalizing task:",r);const b={id:r.id||r.task_id,name:r.name||r.task||"",assignedStaff:r.assignedStaff||(r.staffId?[r.staffId]:r.staff_id?[r.staff_id]:[]),staffInitials:r.staffInitials||(r.firstName&&r.lastName?`${r.firstName[0]}${r.lastName[0]}`.toUpperCase():r.first_name&&r.last_name?`${r.first_name[0]}${r.last_name[0]}`.toUpperCase():""),deadline:r.deadline||r.taskDeadline||r.task_deadline||"",completed:r.completed||!1};return console.log("âœ… Normalized task result:",b),b});return console.log("âœ… All normalized tasks:",s),s},[p,C]=c.useState(""),[m,l]=c.useState(""),[v,S]=c.useState(""),[O,N]=c.useState(""),[U,_]=c.useState(""),[j,$]=c.useState([]),[P,B]=c.useState(""),[M,W]=c.useState([]),[g,E]=c.useState(""),[k,z]=c.useState([]),[A,T]=c.useState({open:!1,message:"",severity:"success"}),[y,L]=c.useState({}),[R,V]=c.useState(!1);c.useEffect(()=>{fetch(`${se}/api/projects/employees`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(t=>t.json()).then(t=>z(t)).catch(()=>z([]))},[]),c.useEffect(()=>{n&&n.id&&(console.log("ðŸ” Fetching project details for ID:",n.id),console.log("ðŸ” API URL:",`${se}/api/projects/${n.id}`),fetch(`${se}/api/projects/${n.id}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(t=>{if(console.log("ðŸ” Response status:",t.status),!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>{console.log("âœ… Fetched project data:",t),console.log("âœ… Tasks from API:",t.tasks),C(I(f(t,"startDate","start_date"))),l(I(f(t,"deadline","deadline"))),S(f(t,"location","location")),N(f(t,"partner","partner")),_(f(t,"notes","additional_notes"));const s=w(t.tasks||[]);console.log("âœ… Normalized tasks:",s),$(s)}).catch(t=>{console.error("âŒ Error fetching project:",t),console.log("ðŸ“‹ Using fallback project data:",n),C(I(f(n,"startDate","start_date"))),l(I(f(n,"deadline","deadline"))),S(f(n,"location","location")),N(f(n,"partner","partner")),_(f(n,"notes","additional_notes"));const s=w(n.tasks||[]);console.log("ðŸ“‹ Fallback tasks:",s),$(s)}))},[n,u]);const q=()=>{if(!P.trim()){T({open:!0,message:"Task name is required.",severity:"error"});return}if(!g){T({open:!0,message:"Task deadline is required.",severity:"error"});return}const t=M.length>0&&k.find(s=>s.employee_id===M[0])?`${k.find(s=>s.employee_id===M[0]).first_name[0]}${k.find(s=>s.employee_id===M[0]).last_name[0]}`.toUpperCase():"";$([...j,{name:P,assignedStaff:M,staffInitials:t,deadline:g,completed:!1}]),B(""),W([]),E(""),V(!1)},X=t=>{$(j.filter((s,r)=>r!==t))},F=(t,s)=>{$(j.map((r,b)=>b===t?{...r,completed:s}:r))},ee=()=>{const t={};return p||(t.startDate="Start Date is required"),m||(t.deadline="Deadline is required"),p&&m&&p>m&&(t.startDate="Start Date cannot be after Deadline"),v||(t.location="Location is required"),j.length===0&&(t.tasks="At least one project task is required"),j.length>0&&j.forEach((s,r)=>{s.name?s.deadline?s.deadline&&(s.deadline<p||s.deadline>m)&&(t.tasks=`Task ${r+1}: Task deadline must be within project start and deadline dates`):t.tasks=`Task ${r+1}: Task deadline is required`:t.tasks=`Task ${r+1}: Task name is required`}),L(t),Object.keys(t).length===0},ae=j.filter(t=>t.completed).length,G=j.length>0?Math.round(ae/j.length*100):0;let J="#e57373";G>75?J="#388e3c":G>50?J="#8bc34a":G>30&&(J="#ffa726");const te=async()=>{if(!ee()){const s=j.length===0&&"A project must have at least one task."||y.startDate||y.deadline||y.location||y.tasks||"Please fill in all required fields.";T({open:!0,message:s,severity:"error"});return}const t={startDate:p,deadline:m,location:v,partner:O,additionalNotes:U,tasks:j.map(s=>({name:s.name,staffId:s.assignedStaff&&s.assignedStaff.length>0?s.assignedStaff[0]:null,taskDeadline:s.deadline,completed:s.completed||!1}))};try{const s=await fetch(`${se}/api/projects/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(s.ok)T({open:!0,message:"Project updated successfully!",severity:"success"}),d&&d(),setTimeout(()=>{a&&a()},1200);else{const r=await s.json();T({open:!0,message:r.error||"Failed to update project.",severity:"error"})}}catch{T({open:!0,message:"Failed to update project.",severity:"error"})}},x=()=>{n&&(C(I(f(n,"startDate","start_date"))),l(I(f(n,"deadline","deadline"))),S(f(n,"location","location")),N(f(n,"partner","partner")),_(f(n,"notes","additional_notes")),$(w(n.tasks||[]))),B(""),W([]),E(""),V(!1),a&&a()};return e.jsxs(ye,{fullScreen:!0,open:u,onClose:x,TransitionComponent:Ft,children:[e.jsx(bt,{sx:{position:"relative"},children:e.jsxs(jt,{children:[e.jsx(ue,{edge:"start",color:"inherit",onClick:x,children:e.jsx(gt,{})}),e.jsx(o,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:"Edit Project Info"})]})}),e.jsxs(i,{sx:{p:4,maxWidth:900,mx:"auto"},children:[e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(D,{label:"Project Name",value:(n==null?void 0:n.title)||"",fullWidth:!0,margin:"normal",InputProps:{readOnly:!0}})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(D,{label:"Category",value:(n==null?void 0:n.category)||"",fullWidth:!0,margin:"normal",InputProps:{readOnly:!0}})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(D,{label:"Start Date",type:"date",value:p||"",onChange:t=>C(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,margin:"normal",required:!0,error:!!y.startDate,helperText:y.startDate})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(D,{label:"Deadline",type:"date",value:m||"",onChange:t=>l(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,margin:"normal",required:!0,error:!!y.deadline,helperText:y.deadline,inputProps:{min:p||void 0}})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(D,{label:"Location",value:v||"",onChange:t=>S(t.target.value),fullWidth:!0,margin:"normal",required:!0,error:!!y.location,helperText:y.location})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(D,{label:"Partner (optional)",value:O||"",onChange:t=>N(t.target.value),fullWidth:!0,margin:"normal"})}),e.jsx(h,{item:!0,xs:12,children:e.jsxs(i,{sx:{mb:2},children:[e.jsxs(o,{variant:"subtitle2",sx:{mb:.5},children:["Completion: ",G,"%"]}),e.jsx(Oe,{variant:"determinate",value:G,sx:{height:12,borderRadius:6,backgroundColor:"#eee","& .MuiLinearProgress-bar":{backgroundColor:J}}})]})}),e.jsxs(h,{item:!0,xs:12,children:[e.jsx(o,{variant:"subtitle1",sx:{mt:2},children:"Project Tasks"}),e.jsx(h,{container:!0,spacing:2,sx:{mt:1,display:"flex",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"stretch"},children:j.length===0?e.jsx(h,{item:!0,xs:12,children:e.jsx(o,{color:"text.secondary",sx:{mb:2},children:"No tasks allocated yet."})}):j.map((t,s)=>e.jsx(h,{item:!0,xs:12,sm:6,md:4,sx:{display:"flex"},children:e.jsxs(ne,{sx:{background:"#23272f",color:"#fff",borderRadius:2,boxShadow:3,mb:2,position:"relative",minHeight:160,height:"100%",width:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"stretch",maxWidth:320},children:[e.jsx(i,{sx:{position:"absolute",top:10,right:10},children:e.jsx(ue,{size:"small",onClick:()=>X(s),sx:{color:"#fff"},children:e.jsx(it,{})})}),e.jsxs(Re,{sx:{pb:"8px !important"},children:[e.jsxs(i,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(i,{display:"flex",alignItems:"center",gap:1,children:t.staffInitials&&e.jsx(i,{sx:{width:32,height:32,borderRadius:"50%",background:"#1976d2",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:16,ml:"auto"},children:t.staffInitials})}),e.jsx(vt,{checked:!!t.completed,onChange:r=>F(s,r.target.checked),sx:{color:"#4caf50","&.Mui-checked":{color:"#4caf50"}}}),e.jsx(o,{variant:"subtitle1",sx:{flexGrow:1,textDecoration:t.completed?"line-through":"none",color:"#fff",fontWeight:500,fontSize:16},children:t.name})]}),e.jsxs(i,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx("span",{style:{display:"inline-block",width:8,height:8,borderRadius:"50%",background:"#ffb300"}}),e.jsx(o,{variant:"body2",sx:{color:"#fff"},children:t.assignedStaff&&t.assignedStaff.length>0?t.assignedStaff.map(r=>{const b=k.find(H=>H.employee_id===r);return b?`${b.first_name} ${b.last_name}`:r}).join(", "):"Unassigned"})]}),e.jsxs(i,{display:"flex",alignItems:"center",gap:1,children:[e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",background:"#8bc34a",color:"#23272f",borderRadius:4,padding:"2px 8px",fontWeight:600,fontSize:13},children:[e.jsx("svg",{style:{marginRight:4},width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})}),t.deadline?new Date(t.deadline).toISOString().slice(0,10):""]}),!t.completed&&t.deadline&&new Date(t.deadline)<new Date&&e.jsx("span",{style:{color:"#ff5252",fontWeight:600,marginLeft:8},children:"Overdue"})]})]})]})},s))}),!R&&e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(Z,{variant:"outlined",startIcon:e.jsx(_e,{}),onClick:()=>V(!0),children:"Add Task"})}),R&&e.jsxs(h,{container:!0,spacing:2,alignItems:"center",sx:{mt:1},children:[e.jsx(h,{item:!0,xs:12,sm:4,children:e.jsx(D,{label:"Task",value:P,onChange:t=>B(t.target.value),fullWidth:!0,error:!!y.tasks,helperText:y.tasks})}),e.jsx(h,{item:!0,xs:12,sm:4,children:e.jsxs(FormControl,{fullWidth:!0,children:[e.jsx(InputLabel,{children:"Assign Staff"}),e.jsx(Select,{multiple:!0,value:M,onChange:t=>W(t.target.value),input:e.jsx(OutlinedInput,{label:"Assign Staff"}),renderValue:t=>e.jsx(i,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(s=>{const r=k.find(b=>b.employee_id===s);return e.jsx(Chip,{label:r?`${r.first_name} ${r.last_name}`:s},s)})}),children:k.map(t=>e.jsxs(MenuItem,{value:t.employee_id,children:[t.first_name," ",t.last_name," (",t.email,")"]},t.employee_id))})]})}),e.jsx(h,{item:!0,xs:12,sm:3,children:e.jsx(D,{label:"Task Deadline",type:"date",value:g,onChange:t=>E(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0})}),e.jsx(h,{item:!0,xs:12,sm:1,children:e.jsx(Z,{variant:"contained",color:"primary",startIcon:e.jsx(_e,{}),onClick:q,sx:{height:56,minWidth:80,mt:{xs:2,sm:0}},fullWidth:!0,children:"ADD"})})]})]}),e.jsx(h,{item:!0,xs:12,children:e.jsx(D,{label:"Additional Notes",value:U||"",onChange:t=>_(t.target.value),fullWidth:!0,multiline:!0,minRows:3,margin:"normal"})})]}),e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:6},children:e.jsx(Z,{variant:"contained",color:"primary",onClick:te,sx:{minWidth:200,fontWeight:600,fontSize:18},children:"UPDATE PROJECT"})}),e.jsx(Se,{open:A.open,autoHideDuration:2500,onClose:()=>T({...A,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(Ce,{onClose:()=>T({...A,open:!1}),severity:A.severity,sx:{width:"100%"},children:A.message})})]})]})}var ke={},Ut=he;Object.defineProperty(ke,"__esModule",{value:!0});var me=ke.default=void 0,Bt=Ut(fe()),Vt=e;me=ke.default=(0,Bt.default)((0,Vt.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");var Ie={},Gt=he;Object.defineProperty(Ie,"__esModule",{value:!0});var He=Ie.default=void 0,Jt=Gt(fe()),Yt=e;He=Ie.default=(0,Jt.default)((0,Yt.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle");var we={},Qt=he;Object.defineProperty(we,"__esModule",{value:!0});var ge=we.default=void 0,Xt=Qt(fe()),Kt=e;ge=we.default=(0,Xt.default)((0,Kt.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"RadioButtonUnchecked");var We={},Zt=he;Object.defineProperty(We,"__esModule",{value:!0});var Ue=We.default=void 0,es=Zt(fe()),ts=e;Ue=We.default=(0,es.default)((0,ts.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");var Te={},ss=he;Object.defineProperty(Te,"__esModule",{value:!0});var Be=Te.default=void 0,rs=ss(fe()),as=e;Be=Te.default=(0,rs.default)((0,as.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");function ns({status:u}){let a="#bdbdbd",n=0,d=e.jsx(ge,{sx:{fontSize:70,color:a}});return u==="Completed"?(a="#43a047",d=e.jsxs(i,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(He,{sx:{fontSize:70,color:a}}),e.jsx(me,{sx:{color:a,fontSize:48,position:"absolute",top:10,left:10,transform:"rotate(0deg)"}})]})):u==="In Progress"?(a="#ffa726",n=90,d=e.jsxs(i,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(ge,{sx:{fontSize:70,color:a}}),e.jsx(me,{sx:{color:a,fontSize:48,position:"absolute",top:10,left:10,transform:`rotate(${n}deg)`}})]})):u==="Not Started"&&(a="#bdbdbd",n=-90,d=e.jsxs(i,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(ge,{sx:{fontSize:70,color:a}}),e.jsx(me,{sx:{color:a,fontSize:48,position:"absolute",top:10,left:10,transform:`rotate(${n}deg)`}})]})),d}const pe=["#43a047","#1976d2","#8e24aa","#fbc02d","#e53935","#00897b","#ff7043","#7e57c2"];function is({projectId:u}){var C,m;const[a,n]=c.useState(null),[d,I]=c.useState(!1);if(c.useEffect(()=>{u&&fetch(`${se}/api/projects/${u}`,{credentials:"include"}).then(l=>l.json()).then(l=>{console.log("Project data with orders:",l),n(l)}).catch(l=>console.error("Error fetching project:",l))},[u]),!a)return null;let f=a.status||"Not Started";a.totalTasks>0&&(a.completedTasks===a.totalTasks?f="Completed":a.completedTasks>0?f="In Progress":f="Not Started");const w=(a.tasks||[]).map(l=>({initials:l.staffInitials,name:`${l.firstName} ${l.lastName}`,role:l.role||l.staffRole||"Staff"})).filter((l,v,S)=>l.initials&&S.findIndex(O=>O.initials===l.initials)===v),p={pending:"warning",delivered:"success",cancelled:"error"};return e.jsx(i,{sx:{p:4,maxWidth:1200,mx:"auto"},children:e.jsxs(ne,{sx:{borderRadius:4,boxShadow:3,p:3},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(o,{variant:"h4",sx:{flexGrow:1,fontWeight:700,color:"#1976d2"},children:a.title}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(ns,{status:f}),e.jsx(o,{variant:"h6",sx:{ml:1,fontWeight:700,color:f==="Completed"?"#43a047":f==="In Progress"?"#ffa726":"#bdbdbd"},children:f})]})]}),e.jsx(o,{variant:"h6",color:"text.secondary",sx:{mb:1},children:a.category}),e.jsx(Q,{sx:{my:2}}),e.jsxs(i,{sx:{mb:3},children:[e.jsx(o,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:"Project Financial Summary"}),e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,sm:4,children:e.jsxs(ne,{sx:{p:3,textAlign:"center",bgcolor:"#e3f2fd",borderRadius:2,height:"100%"},children:[e.jsx(i,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:e.jsx(yt,{sx:{fontSize:40,color:"#1976d2"}})}),e.jsx(o,{variant:"h4",sx:{fontWeight:700,color:"#1976d2",mb:1},children:a.totalOrders||0}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{fontWeight:600},children:"Total Orders"})]})}),e.jsx(h,{item:!0,xs:12,sm:4,children:e.jsxs(ne,{sx:{p:3,textAlign:"center",bgcolor:"#e8f5e8",borderRadius:2,height:"100%"},children:[e.jsx(i,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:e.jsx(o,{variant:"h2",sx:{fontSize:40,color:"#43a047",fontWeight:700},children:"R"})}),e.jsxs(o,{variant:"h4",sx:{fontWeight:700,color:"#43a047",mb:1},children:["R",(a.totalSpent||0).toFixed(2)]}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{fontWeight:600},children:"Total Spent"})]})}),e.jsx(h,{item:!0,xs:12,sm:4,children:e.jsxs(ne,{sx:{p:3,textAlign:"center",bgcolor:"#fff3e0",borderRadius:2,height:"100%"},children:[e.jsx(i,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:e.jsx(o,{variant:"h2",sx:{fontSize:40,color:"#f57c00",fontWeight:700},children:"R"})}),e.jsxs(o,{variant:"h4",sx:{fontWeight:700,color:"#f57c00",mb:1},children:["R",a.totalOrders>0?(a.totalSpent/a.totalOrders).toFixed(2):"0.00"]}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{fontWeight:600},children:"Average per Order"})]})})]}),a.totalOrders>0&&e.jsxs(i,{sx:{mt:2},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>I(!d),children:[e.jsxs(o,{variant:"subtitle1",sx:{fontWeight:600,mr:1},children:["Order Details (",a.totalOrders," orders)"]}),e.jsx(ue,{size:"small",children:d?e.jsx(Be,{}):e.jsx(Ue,{})})]}),e.jsx(_t,{in:d,children:e.jsx(Ct,{component:be,sx:{mt:2,maxHeight:400},children:e.jsxs(St,{stickyHeader:!0,size:"small",children:[e.jsx(kt,{children:e.jsxs(Me,{children:[e.jsx(K,{children:"Order #"}),e.jsx(K,{children:"Customer"}),e.jsx(K,{align:"right",children:"Amount"}),e.jsx(K,{children:"Status"}),e.jsx(K,{children:"Date"})]})}),e.jsx(It,{children:(a.ordersList||[]).map(l=>e.jsxs(Me,{children:[e.jsx(K,{children:l.orderno}),e.jsx(K,{children:l.customer}),e.jsxs(K,{align:"right",children:["R",l.amount.toFixed(2)]}),e.jsx(K,{children:e.jsx(re,{label:l.status.charAt(0).toUpperCase()+l.status.slice(1),color:p[l.status]||"default",size:"small"})}),e.jsx(K,{children:l.deliveryDate?new Date(l.deliveryDate).toLocaleDateString():new Date(l.createdAt).toLocaleDateString()})]},l.orderno))})]})})})]})]}),e.jsx(Q,{sx:{my:2}}),e.jsxs(h,{container:!0,spacing:2,children:[e.jsxs(h,{item:!0,xs:12,sm:6,children:[e.jsxs(o,{children:[e.jsx("b",{style:{color:"#43a047"},children:"Start Date:"})," ",e.jsx("span",{style:{color:"#43a047"},children:(C=a.start_date)==null?void 0:C.toString().slice(0,10)})]}),e.jsxs(o,{children:[e.jsx("b",{style:{color:"#e53935"},children:"Deadline:"})," ",e.jsx("span",{style:{color:"#e53935"},children:(m=a.deadline)==null?void 0:m.toString().slice(0,10)})]}),e.jsxs(o,{children:[e.jsx("b",{children:"Location:"}),e.jsx("br",{}),e.jsx("span",{style:{whiteSpace:"pre-line"},children:a.location})]}),e.jsxs(o,{children:[e.jsx("b",{children:"Partner:"})," ",a.partner]})]}),e.jsxs(h,{item:!0,xs:12,sm:6,children:[e.jsxs(o,{children:[e.jsx("b",{children:"Category:"})," ",a.category]}),e.jsxs(o,{children:[e.jsx("b",{children:"Notes:"})," ",a.notes||"-"]})]})]}),e.jsx(Q,{sx:{my:2}}),e.jsx(o,{variant:"h6",sx:{mb:1},children:"Tasks"}),e.jsx(i,{sx:{mb:2},children:(a.tasks||[]).length===0?e.jsx(o,{color:"text.secondary",children:"No tasks allocated yet."}):e.jsx(h,{container:!0,spacing:2,alignItems:"stretch",children:a.tasks.map((l,v)=>{var S;return e.jsx(h,{item:!0,xs:12,sm:6,md:4,sx:{display:"flex"},children:e.jsxs(ne,{sx:{background:"#f5f5f5",borderRadius:2,boxShadow:1,p:2,minHeight:200,height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-between"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(oe,{sx:{bgcolor:pe[v%pe.length],mr:1,width:56,height:56,fontSize:24,fontWeight:700},children:l.staffInitials||"NA"}),e.jsxs(i,{children:[e.jsx(o,{sx:{fontWeight:600},children:l.name}),e.jsxs(o,{variant:"body2",color:"text.secondary",children:[l.firstName," ",l.lastName]}),e.jsx(o,{variant:"caption",color:"text.secondary",children:l.role||"Staff"})]})]}),e.jsxs(o,{variant:"body2",sx:{mb:.5},children:[e.jsx("b",{children:"Deadline:"})," "," ",e.jsx("span",{style:{color:"#e53935"},children:(S=l.taskDeadline)==null?void 0:S.toString().slice(0,10)})]}),e.jsx(re,{label:l.completed?"Completed":"Pending",size:"small",sx:{bgcolor:l.completed?"#43a047":"#ffa726",color:"#fff",fontWeight:600,mt:.5,fontSize:16,height:32}})]})},l.id||v)})})}),e.jsx(Q,{sx:{my:2}}),e.jsx(o,{variant:"h6",sx:{mb:1},children:"Team Involved"}),e.jsx(i,{sx:{display:"flex",gap:3,flexWrap:"wrap",mb:4},children:w.length===0?e.jsx(o,{color:"text.secondary",children:"No team members assigned."}):w.map((l,v)=>e.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(oe,{sx:{bgcolor:pe[v%pe.length],width:56,height:56,fontSize:22,fontWeight:700,mb:1},children:l.initials}),e.jsx(o,{sx:{fontWeight:600},children:l.initials}),e.jsx(o,{variant:"caption",color:"text.secondary",children:l.role})]},v))}),e.jsx(Q,{sx:{my:2}}),e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600,color:"#1976d2"},children:"Managed by: Lynette Johnson"})})]})})}const os=[{label:"Project Status",value:"status"},{label:"Name",value:"name"},{label:"Deadline",value:"deadline"},{label:"Category",value:"category"},{label:"Location",value:"location"}],Le=[{label:"All",value:"all"},{label:"Training Program",value:"training"},{label:"Product Launching",value:"product"},{label:"Handicraft Program",value:"handicraft"},{label:"Speaker Program",value:"speaker"}];function ls(u,a){switch(a){case"name":return[...u].sort((n,d)=>n.title.localeCompare(d.title));case"deadline":return[...u].sort((n,d)=>new Date(n.deadline)-new Date(d.deadline));case"category":return[...u].sort((n,d)=>n.category.localeCompare(d.category));case"location":return[...u].sort((n,d)=>n.location.localeCompare(d.location));case"status":default:return[...u].sort((n,d)=>n.status.localeCompare(d.status))}}function ds(){var J,te;const[u,a]=c.useState(""),[n,d]=c.useState("all"),[I,f]=c.useState("status"),[w,p]=c.useState(!1),[C,m]=c.useState([]),[l,v]=c.useState(!0),[S,O]=c.useState(!1),[N,U]=c.useState(null),[_,j]=c.useState({open:!1,message:"",severity:"success"}),[$,P]=c.useState(!1),[B,M]=c.useState(null),[W,g]=c.useState(null),E=async()=>{v(!0),U(null);try{const x=await fetch(`${se}/api/projects`,{credentials:"include"});if(!x.ok)throw new Error("Failed to fetch projects");const t=await x.json();m(t)}catch(x){U(x.message||"Error fetching projects")}finally{v(!1)}};c.useEffect(()=>{E()},[]);const k=C.filter(x=>(n==="all"||x.category===n)&&x.title.toLowerCase().includes(u.toLowerCase())),z=ls(k,I),A=()=>p(!0),T=()=>p(!1),[y,L]=c.useState(!1),[R,V]=c.useState(null),q=x=>{V(x),L(!0)},X=()=>L(!1),F=()=>{L(!1),E(),j({open:!0,message:"Project updated successfully!",severity:"success"})},ee=async x=>{p(!1),O(!0);try{await E(),j({open:!0,message:`Project "${(x==null?void 0:x.title)||(x==null?void 0:x.projectName)||"New project"}" created and list updated successfully!`,severity:"success"})}catch(t){console.error("Error refreshing projects:",t),j({open:!0,message:"Project created but failed to refresh list. Please refresh manually.",severity:"warning"})}finally{O(!1)}},ae=x=>{M(x),g(x.id),P(!0)},G=()=>P(!1);return e.jsxs(i,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",p:0},children:[e.jsxs(i,{sx:{bgcolor:"rgba(255,255,255,0.95)",backdropFilter:"blur(10px)",borderBottom:"3px solid #667eea",p:4,mb:0,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:3,mb:2},children:[e.jsx(oe,{sx:{bgcolor:"#667eea",width:64,height:64,boxShadow:"0 6px 16px rgba(102, 126, 234, 0.3)"},children:e.jsx(je,{sx:{fontSize:36,color:"white"}})}),e.jsxs(i,{sx:{textAlign:"center"},children:[e.jsx(o,{variant:"h3",sx:{fontWeight:"bold",background:"linear-gradient(45deg, #667eea, #764ba2)",backgroundClip:"text",color:"transparent",mb:1},children:"Project Management"}),e.jsx(o,{variant:"h6",sx:{color:"#64748b",fontWeight:"500"},children:"Plan, organize, and track your project workflows"}),e.jsxs(o,{variant:"body2",sx:{color:"#94a3b8",fontWeight:"400",mt:1},children:["Access Level: ",((J=at())==null?void 0:J.role)||"Unknown"," â€¢ Projects Module"]})]})]}),e.jsxs(be,{sx:{p:3,mt:3,borderRadius:3,background:"rgba(255,255,255,0.9)",backdropFilter:"blur(10px)",boxShadow:"0 8px 32px rgba(0,0,0,0.1)",border:"1px solid rgba(255,255,255,0.2)"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx($t,{sx:{color:"#667eea",fontSize:28}}),e.jsx(o,{variant:"h6",sx:{fontWeight:"bold",color:"#2d3748"},children:"Search & Filter Projects"})]}),e.jsx(Q,{sx:{mb:3,borderColor:"#667eea",borderWidth:1}}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:{xs:"wrap",sm:"nowrap"}},children:[e.jsx(D,{label:"Search projects...",variant:"outlined",size:"medium",value:u,onChange:x=>a(x.target.value),InputProps:{startAdornment:e.jsx(Lt,{sx:{color:"#667eea",mr:1}})},sx:{flex:2,minWidth:280,"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#667eea",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#667eea"}}}),e.jsxs(le,{size:"medium",sx:{minWidth:180},children:[e.jsx(de,{children:"Sort by"}),e.jsx(ce,{value:I,label:"Sort by",onChange:x=>f(x.target.value),sx:{"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#48bb78",borderWidth:2},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#48bb78",borderWidth:2}},children:os.map(x=>e.jsx(ie,{value:x.value,children:x.label},x.value))})]}),e.jsxs(le,{size:"medium",sx:{minWidth:180},children:[e.jsx(de,{children:"Category"}),e.jsx(ce,{value:n,label:"Category",onChange:x=>d(x.target.value),sx:{"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#ed8936",borderWidth:2},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#ed8936",borderWidth:2}},children:Le.map(x=>e.jsx(ie,{value:x.value,children:x.label},x.value))})]}),e.jsx(Z,{variant:"contained",startIcon:e.jsx(qe,{}),size:"large",onClick:A,sx:{py:1.8,px:4,fontWeight:"bold",fontSize:16,borderRadius:2,minWidth:200,background:"linear-gradient(45deg, #667eea, #764ba2)",color:"white",textTransform:"none",whiteSpace:"nowrap",boxShadow:"0 4px 16px rgba(102, 126, 234, 0.3)","&:hover":{background:"linear-gradient(45deg, #5a67d8, #6b46c1)",transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(102, 126, 234, 0.4)"}},children:"Create Project"})]}),e.jsxs(i,{sx:{mt:3,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(re,{label:`Total Projects: ${C.length}`,sx:{bgcolor:"#667eea",color:"white",fontWeight:"bold",fontSize:"0.9rem"}}),e.jsx(re,{label:`Filtered: ${z.length}`,sx:{bgcolor:"#48bb78",color:"white",fontWeight:"bold",fontSize:"0.9rem"}}),n!=="all"&&e.jsx(re,{label:`Category: ${(te=Le.find(x=>x.value===n))==null?void 0:te.label}`,sx:{bgcolor:"#ed8936",color:"white",fontWeight:"bold",fontSize:"0.9rem"}})]})]})]}),e.jsx(i,{sx:{p:4,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",minHeight:"calc(100vh - 280px)"},children:e.jsx(be,{sx:{p:4,borderRadius:3,background:"rgba(255,255,255,0.95)",backdropFilter:"blur(10px)",boxShadow:"0 20px 40px rgba(0,0,0,0.1)",border:"1px solid rgba(255,255,255,0.2)",minHeight:"400px"},children:l||S?e.jsxs(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"300px",flexDirection:"column",gap:2},children:[e.jsx(oe,{sx:{bgcolor:"#667eea",width:80,height:80,animation:"pulse 2s infinite"},children:e.jsx(je,{sx:{fontSize:40}})}),e.jsx(o,{variant:"h6",sx:{color:"#64748b"},children:S?"Updating projects...":"Loading projects..."})]}):N?e.jsxs(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"300px",flexDirection:"column",gap:2},children:[e.jsx(o,{variant:"h6",color:"error",sx:{textAlign:"center"},children:N}),e.jsx(Z,{variant:"contained",onClick:E,sx:{background:"linear-gradient(45deg, #667eea, #764ba2)","&:hover":{background:"linear-gradient(45deg, #5a67d8, #6b46c1)"}},children:"Retry"})]}):e.jsx(Rt,{projects:z,onEdit:q,onView:ae})})}),e.jsx(Se,{open:_.open,autoHideDuration:4e3,onClose:()=>j({..._,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(Ce,{onClose:()=>j({..._,open:!1}),severity:_.severity,sx:{width:"100%"},children:_.message})}),e.jsx(qt,{open:w,onClose:T,onSave:ee}),R&&e.jsx(Ht,{open:y,onClose:X,project:R,onSave:F}),B&&e.jsx(ye,{open:$,onClose:G,maxWidth:"md",fullWidth:!0,scroll:"body",children:e.jsx(i,{sx:{p:2},children:e.jsx(is,{projectId:W})})})]})}const Fs=rt(ds,"projects");export{ds as Projects,Fs as default};
