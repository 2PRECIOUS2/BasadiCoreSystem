import{j as e,a0 as h,a1 as Z,ao as Fe,a6 as ze,B as a,f as n,a3 as ee,a2 as $e,e as H,p as Le,o as je,K as se,af as fe,am as Ue,an as He,I as oe,ac as Be,P as he,ap as Te,D as U,T as S,F as me,a9 as pe,t as ge,M as be,aq as We,v as Ge,a4 as Oe,L as Ve,b as Je,d as Ye,ar as Ke,as as Qe,a8 as Xe,at as Ze,S as ve,A as ye,Q as et,R as tt,x as st,i as le,au as rt,g as at,h as nt,k as it,l as De,m as F,n as ot,av as lt,aw as dt}from"./mui-051d3b2b.js";import{b as Ae,r as d}from"./vendor-0625b040.js";import"./utils-f1b31201.js";import{A as X,d as Pe,r as de,b as ct,w as ut,a as xt}from"./index-755be80d.js";import{d as ht}from"./Close-cde7281f.js";import{d as ft}from"./Delete-35b59c04.js";const _e={training:"https://source.unsplash.com/400x200/?training,education",product:"https://source.unsplash.com/400x200/?product,launch",default:"https://source.unsplash.com/400x200/?project"};function mt(p){return _e[p]||_e.default}function pt({projects:p,onEdit:l,onView:i}){return e.jsx(h,{container:!0,spacing:3,children:p.map(u=>{const D=new Date,f=new Date(u.start_date||u.startDate||u.startdate),w=u.totalTasks||(u.tasks?u.tasks.length:0),j=u.completedTasks!==void 0?u.completedTasks:u.tasks?u.tasks.filter(T=>T.completed).length:0,k=w>0?Math.round(j/w*100):0;let g="#e57373";k>75?g="#388e3c":k>50?g="#8bc34a":k>30&&(g="#ffa726");let o="Not Started";w>0&&(j===w?o="Completed":(j>0||D>=f)&&(o="In Progress"));let b="warning";return o==="Completed"?b="success":o==="Not Started"&&(b="default"),e.jsx(h,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(Z,{sx:{height:390,display:"flex",flexDirection:"column"},children:[e.jsx(Fe,{component:"img",height:"140",image:u.image?u.image:mt(u.category),alt:u.category,sx:{objectFit:"cover"}}),e.jsxs(ze,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"space-between",minHeight:200},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(n,{variant:"h6",sx:{fontWeight:500,fontSize:20,lineHeight:1.2},children:u.title}),e.jsx(ee,{label:o,color:b,size:"small"})]}),e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Completed Tasks: ",e.jsxs("b",{children:[j,"/",w]})]}),e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Deadline: ",e.jsx("b",{children:u.deadline?u.deadline.slice(0,10):""})]}),e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["Location: ",e.jsx("b",{children:u.location})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx($e,{variant:"determinate",value:k,sx:{flexGrow:1,mr:1,height:10,borderRadius:5,backgroundColor:"#f5f5f5","& .MuiLinearProgress-bar1Determinate":{backgroundColor:g}}}),e.jsxs(n,{variant:"body2",children:[k,"%"]})]}),e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(H,{size:"small",variant:"outlined",onClick:()=>i&&i(u),children:"View Details"}),e.jsx(H,{size:"small",variant:"contained",onClick:()=>l&&l(u),children:"Edit Project Info"})]})]})]})},u.id)})})}const gt=[{label:"Training Program",value:"training"},{label:"Handicraft Program",value:"handicraft"},{label:"Product Launching",value:"product"},{label:"Speaker Program",value:"speaker"}],bt=Ae.forwardRef(function(l,i){return e.jsx(Le,{direction:"up",ref:i,...l})});function jt({open:p,onClose:l,onSave:i}){const[u,D]=d.useState(""),[f,w]=d.useState(""),[j,k]=d.useState(""),[g,o]=d.useState(""),[b,T]=d.useState(""),[L,R]=d.useState(""),[B,M]=d.useState(""),[z,N]=d.useState(!1),[v,W]=d.useState({open:!1,message:"",severity:"success"}),[C,K]=d.useState({}),[I,$]=d.useState([]),[G,E]=d.useState(""),[O,Q]=d.useState([]),[A,P]=d.useState(""),[y,te]=d.useState(""),[V,J]=d.useState([]);d.useEffect(()=>{p&&(async()=>{try{const s=await fetch(`${X}/api/projects/employees`,{credentials:"include"});if(s.ok){const m=await s.json();J(Array.isArray(m)?m:[])}else console.warn("Failed to fetch staff list, using empty array"),J([])}catch(s){console.warn("Error fetching staff list:",s),J([])}})()},[p]);const re=()=>{if(!G.trim()){W({open:!0,message:"Task name is required.",severity:"error"});return}if(!A){W({open:!0,message:"Task deadline is required.",severity:"error"});return}$([...I,{name:G,assignedStaff:O,deadline:A}]),E(""),Q([]),P("")},ae=r=>{$(I.filter((s,m)=>m!==r))},ne=()=>{const r={};return u||(r.projectName="Project Name is required"),f||(r.category="Category is required"),j||(r.startDate="Start Date is required"),g||(r.deadline="Deadline is required"),b||(r.location="Location is required"),B||(r.description="Project description is required"),I.length===0&&(r.tasks="At least one project task is required"),j&&g&&j>g&&(r.deadline="Deadline cannot be before start date"),I.forEach((s,m)=>{s.deadline&&j&&s.deadline<j&&(r.tasks="Task deadlines cannot be before project start date"),s.deadline&&g&&s.deadline>g&&(r.tasks="Task deadlines cannot be after project deadline")}),K(r),Object.keys(r).length===0},ie=async r=>{if(r.preventDefault(),!ne()){W({open:!0,message:"Please fill in all required fields.",severity:"error"});return}N(!0);const s={projectName:u,category:f,startDate:j,deadline:g,location:b,partner:L,description:B,tasks:I.map(m=>({name:m.name,staffId:m.assignedStaff.length>0?m.assignedStaff[0]:null,taskDeadline:m.deadline,completed:!1})),additionalNotes:y,status:"active"};try{const m=await fetch(`${X}/api/projects`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"});if(m.ok){const _=await m.json();W({open:!0,message:"Project created successfully!",severity:"success"}),Y(),i&&i(_)}else{const _=await m.json();W({open:!0,message:_.message||"Failed to create project",severity:"error"})}}catch(m){console.error("Error creating project:",m),W({open:!0,message:"Network error. Please try again.",severity:"error"})}finally{N(!1)}},Y=()=>{D(""),w(""),k(""),o(""),T(""),R(""),M(""),$([]),E(""),Q([]),P(""),te(""),K({}),N(!1),l()};return e.jsx(je,{fullScreen:!0,open:p,onClose:Y,TransitionComponent:bt,PaperProps:{sx:{backgroundColor:"#f8fafc",backgroundImage:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},children:e.jsxs("form",{onSubmit:ie,children:[e.jsxs(a,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:[e.jsxs(a,{sx:{bgcolor:"rgba(255,255,255,0.95)",backdropFilter:"blur(10px)",borderBottom:"3px solid #667eea",p:3,display:"flex",alignItems:"center",justifyContent:"space-between",boxShadow:"0 4px 20px rgba(0,0,0,0.1)"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(se,{sx:{bgcolor:"#667eea",width:56,height:56,boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)"},children:e.jsx(fe,{sx:{fontSize:32,color:"white"}})}),e.jsxs(a,{children:[e.jsx(n,{variant:"h4",sx:{fontWeight:"bold",background:"linear-gradient(45deg, #667eea, #764ba2)",backgroundClip:"text",color:"transparent",mb:.5},children:"Create New Project"}),e.jsxs(n,{variant:"h6",sx:{color:"#64748b",display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ue,{sx:{fontSize:20}}),"Plan and organize your project workflow"]})]})]}),e.jsx(He,{title:"Close",children:e.jsx(oe,{onClick:Y,sx:{color:"#667eea","&:hover":{bgcolor:"rgba(102, 126, 234, 0.1)",transform:"scale(1.1)"}},children:e.jsx(Be,{sx:{fontSize:30}})})})]}),e.jsx(a,{sx:{flex:1,p:4,display:"flex",justifyContent:"center",alignItems:"flex-start"},children:e.jsxs(he,{sx:{maxWidth:1e3,width:"100%",p:4,borderRadius:3,background:"rgba(255,255,255,0.95)",backdropFilter:"blur(10px)",boxShadow:"0 20px 40px rgba(0,0,0,0.1)",border:"1px solid rgba(255,255,255,0.2)"},children:[e.jsxs(a,{sx:{mb:4},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(Te,{sx:{color:"#667eea",fontSize:28}}),e.jsx(n,{variant:"h6",sx:{fontWeight:"bold",color:"#2d3748"},children:"Project Details"})]}),e.jsx(U,{sx:{mb:3,borderColor:"#667eea",borderWidth:1}}),e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:"Project Name",value:u,onChange:r=>D(r.target.value),required:!0,fullWidth:!0,error:!!C.projectName,helperText:C.projectName,sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#667eea",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#667eea"}}})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsxs(me,{fullWidth:!0,error:!!C.category,children:[e.jsx(pe,{children:"Project Category"}),e.jsx(ge,{value:f,label:"Project Category",onChange:r=>w(r.target.value),required:!0,sx:{"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#667eea",borderWidth:2},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#667eea",borderWidth:2}},children:gt.map(r=>e.jsx(be,{value:r.value,children:r.label},r.value))}),C.category&&e.jsx(n,{color:"error",variant:"caption",children:C.category})]})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:"Start Date",type:"date",value:j,onChange:r=>k(r.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,required:!0,error:!!C.startDate,helperText:C.startDate,sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#48bb78",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#48bb78",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#48bb78"}}})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:"Deadline",type:"date",value:g,onChange:r=>o(r.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,required:!0,error:!!C.deadline,helperText:C.deadline,inputProps:{min:j||void 0},sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#ed8936",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#ed8936",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#ed8936"}}})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:"Location",value:b,onChange:r=>T(r.target.value),fullWidth:!0,required:!0,error:!!C.location,helperText:C.location,sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#805ad5",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#805ad5",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#805ad5"}}})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:"Partner (Optional)",value:L,onChange:r=>R(r.target.value),fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#667eea",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#667eea"}}})})]})]}),e.jsxs(a,{sx:{mb:4},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(We,{sx:{color:"#667eea",fontSize:28}}),e.jsx(n,{variant:"h6",sx:{fontWeight:"bold",color:"#2d3748"},children:"Project Tasks"})]}),e.jsx(U,{sx:{mb:3,borderColor:"#667eea",borderWidth:1}}),e.jsxs(a,{sx:{p:3,border:"1px solid #e2e8f0",borderRadius:2,mb:3,backgroundColor:"#f8fafc"},children:[e.jsx(n,{variant:"subtitle1",sx:{mb:2,fontWeight:"bold"},children:"Add New Task"}),e.jsxs(h,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(h,{item:!0,xs:12,sm:4,children:e.jsx(S,{label:"Task Name",value:G,onChange:r=>E(r.target.value),fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea"},"&.Mui-focused fieldset":{borderColor:"#667eea"}}}})}),e.jsx(h,{item:!0,xs:12,sm:3,children:e.jsx(Ge,{multiple:!0,size:"small",value:V.filter(r=>O.includes(r.employee_id)),onChange:(r,s)=>{Q(s.map(m=>m.employee_id))},options:V,getOptionLabel:r=>`${r.first_name} ${r.last_name}`,isOptionEqualToValue:(r,s)=>r.employee_id===s.employee_id,renderInput:r=>e.jsx(S,{...r,label:"Search & Assign Staff",placeholder:"Search employees...",sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea"},"&.Mui-focused fieldset":{borderColor:"#667eea"}}}}),renderOption:(r,s)=>{var m,_;return e.jsxs(a,{component:"li",...r,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(se,{sx:{width:24,height:24,bgcolor:"#667eea",fontSize:"0.75rem"},children:[(m=s.first_name)==null?void 0:m.charAt(0),(_=s.last_name)==null?void 0:_.charAt(0)]}),e.jsxs(a,{children:[e.jsxs(n,{variant:"body2",children:[s.first_name," ",s.last_name]}),s.email&&e.jsx(n,{variant:"caption",color:"textSecondary",children:s.email})]})]})},renderTags:(r,s)=>r.map((m,_)=>e.jsx(ee,{variant:"outlined",label:`${m.first_name} ${m.last_name}`,size:"small",...s({index:_}),sx:{bgcolor:"#f0f4ff",borderColor:"#667eea",color:"#667eea"}})),noOptionsText:"No employees found",loading:V.length===0,loadingText:"Loading employees..."})}),e.jsx(h,{item:!0,xs:12,sm:3,children:e.jsx(S,{label:"Task Deadline",type:"date",value:A,onChange:r=>P(r.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,size:"small",inputProps:{min:j||void 0,max:g||void 0},sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea"},"&.Mui-focused fieldset":{borderColor:"#667eea"}}}})}),e.jsx(h,{item:!0,xs:12,sm:2,children:e.jsx(H,{variant:"contained",onClick:re,fullWidth:!0,startIcon:e.jsx(Oe,{}),sx:{background:"linear-gradient(45deg, #667eea, #764ba2)","&:hover":{background:"linear-gradient(45deg, #5a67d8, #6b46c1)"}},children:"Add Task"})})]})]}),I.length>0&&e.jsxs(a,{sx:{border:"1px solid #e2e8f0",borderRadius:2,backgroundColor:"white"},children:[e.jsxs(n,{variant:"subtitle1",sx:{p:2,fontWeight:"bold",borderBottom:"1px solid #e2e8f0"},children:["Project Tasks (",I.length,")"]}),e.jsx(Ve,{dense:!0,children:I.map((r,s)=>e.jsxs(Je,{divider:s<I.length-1,children:[e.jsx(Ye,{primary:e.jsx(n,{variant:"body1",sx:{fontWeight:"medium"},children:r.name}),secondary:e.jsxs(a,{sx:{mt:1},children:[e.jsxs(n,{variant:"body2",color:"textSecondary",children:[e.jsx("strong",{children:"Assigned to:"})," ",r.assignedStaff.length>0?r.assignedStaff.map(m=>{const _=V.find(t=>t.employee_id===m);return _?`${_.first_name} ${_.last_name}`:m}).join(", "):"Unassigned"]}),e.jsxs(n,{variant:"body2",color:"textSecondary",children:[e.jsx("strong",{children:"Deadline:"})," ",r.deadline]})]})}),e.jsx(Ke,{children:e.jsx(oe,{edge:"end",onClick:()=>ae(s),color:"error",size:"small",children:e.jsx(Qe,{})})})]},s))})]})]}),e.jsxs(a,{sx:{mb:4},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(We,{sx:{color:"#667eea",fontSize:28}}),e.jsx(n,{variant:"h6",sx:{fontWeight:"bold",color:"#2d3748"},children:"Project Description"})]}),e.jsx(U,{sx:{mb:3,borderColor:"#667eea",borderWidth:1}}),e.jsx(S,{label:"Describe your project goals, requirements, and deliverables",value:B,onChange:r=>M(r.target.value),multiline:!0,rows:6,fullWidth:!0,required:!0,error:!!C.description,helperText:C.description,sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#667eea",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#667eea"}}})]}),e.jsxs(a,{sx:{mb:4},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(Te,{sx:{color:"#667eea",fontSize:28}}),e.jsx(n,{variant:"h6",sx:{fontWeight:"bold",color:"#2d3748"},children:"Additional Notes (Optional)"})]}),e.jsx(U,{sx:{mb:3,borderColor:"#667eea",borderWidth:1}}),e.jsx(S,{label:"Any additional information, requirements, or special considerations",value:y,onChange:r=>te(r.target.value),multiline:!0,rows:3,fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#667eea",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#667eea"}}})]}),e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pt:3,borderTop:"2px solid #e2e8f0"},children:[e.jsx(H,{onClick:Y,variant:"outlined",size:"large",sx:{borderColor:"#94a3b8",color:"#64748b",px:4,py:1.5,"&:hover":{borderColor:"#64748b",backgroundColor:"rgba(100, 116, 139, 0.04)"}},children:"Cancel"}),e.jsx(H,{type:"submit",variant:"contained",size:"large",disabled:z,startIcon:z?e.jsx(Xe,{size:20}):e.jsx(Ze,{}),sx:{background:"linear-gradient(45deg, #667eea, #764ba2)",color:"white",px:4,py:1.5,fontWeight:"bold","&:hover":{background:"linear-gradient(45deg, #5a67d8, #6b46c1)",transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(102, 126, 234, 0.3)"},"&:disabled":{background:"#94a3b8"}},children:z?"Creating...":"Create Project"})]})]})})]}),e.jsx(ve,{open:v.open,autoHideDuration:4e3,onClose:()=>W({...v,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(ye,{onClose:()=>W({...v,open:!1}),severity:v.severity,sx:{width:"100%"},children:v.message})})]})})}const vt=Ae.forwardRef(function(l,i){return e.jsx(Le,{direction:"up",ref:i,...l})});function yt({open:p,onClose:l,project:i,onSave:u}){const D=t=>{if(!t)return"";const c=typeof t=="string"?new Date(t):t;return isNaN(c)?"":c.toISOString().slice(0,10)},f=(t,c,x)=>t[c]!==void 0?t[c]:t[x]||"",w=t=>{if(!Array.isArray(t))return console.log("⚠️ normalizeTasks: tasksArr is not an array:",t),[];const c=t.map(x=>{console.log("🔄 Normalizing task:",x);const q={id:x.id||x.task_id,name:x.name||x.task||"",assignedStaff:x.assignedStaff||(x.staffId?[x.staffId]:x.staff_id?[x.staff_id]:[]),staffInitials:x.staffInitials||(x.firstName&&x.lastName?`${x.firstName[0]}${x.lastName[0]}`.toUpperCase():x.first_name&&x.last_name?`${x.first_name[0]}${x.last_name[0]}`.toUpperCase():""),deadline:x.deadline||x.taskDeadline||x.task_deadline||"",completed:x.completed||!1};return console.log("✅ Normalized task result:",q),q});return console.log("✅ All normalized tasks:",c),c},[j,k]=d.useState(""),[g,o]=d.useState(""),[b,T]=d.useState(""),[L,R]=d.useState(""),[B,M]=d.useState(""),[z,N]=d.useState(""),[v,W]=d.useState([]),[C,K]=d.useState(""),[I,$]=d.useState([]),[G,E]=d.useState(""),[O,Q]=d.useState([]),[A,P]=d.useState({open:!1,message:"",severity:"success"}),[y,te]=d.useState({}),[V,J]=d.useState(!1);d.useEffect(()=>{fetch(`${X}/api/projects/employees`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(t=>t.json()).then(t=>Q(t)).catch(()=>Q([]))},[]),d.useEffect(()=>{i&&i.id&&(console.log("🔍 Fetching project details for ID:",i.id),console.log("🔍 API URL:",`${X}/api/projects/${i.id}`),fetch(`${X}/api/projects/${i.id}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(t=>{if(console.log("🔍 Response status:",t.status),!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>{console.log("✅ Fetched project data:",t),console.log("✅ Tasks from API:",t.tasks),k(f(t,"title","title")),o(D(f(t,"startDate","start_date"))),T(D(f(t,"deadline","deadline"))),R(f(t,"location","location")),M(f(t,"partner","partner")),N(f(t,"notes","additional_notes"));const c=w(t.tasks||[]);console.log("✅ Normalized tasks:",c),W(c)}).catch(t=>{console.error("❌ Error fetching project:",t),console.log("📋 Using fallback project data:",i),k(f(i,"title","title")),o(D(f(i,"startDate","start_date"))),T(D(f(i,"deadline","deadline"))),R(f(i,"location","location")),M(f(i,"partner","partner")),N(f(i,"notes","additional_notes"));const c=w(i.tasks||[]);console.log("📋 Fallback tasks:",c),W(c)}))},[i,p]);const re=()=>{if(!C.trim()){P({open:!0,message:"Task name is required.",severity:"error"});return}if(!G){P({open:!0,message:"Task deadline is required.",severity:"error"});return}const t=I.length>0&&O.find(c=>c.employee_id===I[0])?`${O.find(c=>c.employee_id===I[0]).first_name[0]}${O.find(c=>c.employee_id===I[0]).last_name[0]}`.toUpperCase():"";W([...v,{name:C,assignedStaff:I,staffInitials:t,deadline:G,completed:!1}]),K(""),$([]),E(""),J(!1)},ae=t=>{W(v.filter((c,x)=>x!==t))},ne=(t,c)=>{W(v.map((x,q)=>q===t?{...x,completed:c}:x))},ie=()=>{const t={};return j||(t.title="Project Name is required"),g||(t.startDate="Start Date is required"),b||(t.deadline="Deadline is required"),g&&b&&g>b&&(t.startDate="Start Date cannot be after Deadline"),L||(t.location="Location is required"),v.length===0&&(t.tasks="At least one project task is required"),v.length>0&&v.forEach((c,x)=>{c.name?c.deadline?c.deadline&&(c.deadline<g||c.deadline>b)&&(t.tasks=`Task ${x+1}: Task deadline must be within project start and deadline dates`):t.tasks=`Task ${x+1}: Task deadline is required`:t.tasks=`Task ${x+1}: Task name is required`}),te(t),Object.keys(t).length===0},Y=v.filter(t=>t.completed).length,r=v.length>0?Math.round(Y/v.length*100):0;let s="#e57373";r>75?s="#388e3c":r>50?s="#8bc34a":r>30&&(s="#ffa726");const m=async()=>{if(!ie()){const c=v.length===0&&"A project must have at least one task."||y.startDate||y.deadline||y.location||y.tasks||"Please fill in all required fields.";P({open:!0,message:c,severity:"error"});return}const t={title:j,startDate:g,deadline:b,location:L,partner:B,additionalNotes:z,tasks:v.map(c=>({name:c.name,staffId:c.assignedStaff&&c.assignedStaff.length>0?c.assignedStaff[0]:null,taskDeadline:c.deadline,completed:c.completed||!1}))};try{const c=await fetch(`${X}/api/projects/${i.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(c.ok)P({open:!0,message:"Project updated successfully!",severity:"success"}),u&&u(),setTimeout(()=>{l&&l()},1200);else{const x=await c.json();P({open:!0,message:x.error||"Failed to update project.",severity:"error"})}}catch{P({open:!0,message:"Failed to update project.",severity:"error"})}},_=()=>{i&&(o(D(f(i,"startDate","start_date"))),T(D(f(i,"deadline","deadline"))),R(f(i,"location","location")),M(f(i,"partner","partner")),N(f(i,"notes","additional_notes")),W(w(i.tasks||[]))),K(""),$([]),E(""),J(!1),l&&l()};return e.jsxs(je,{fullScreen:!0,open:p,onClose:_,TransitionComponent:vt,children:[e.jsx(et,{sx:{position:"relative"},children:e.jsxs(tt,{children:[e.jsx(oe,{edge:"start",color:"inherit",onClick:_,children:e.jsx(ht,{})}),e.jsx(n,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:"Edit Project Info"})]})}),e.jsxs(a,{sx:{p:4,maxWidth:900,mx:"auto"},children:[e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:"Project Name",value:j,onChange:t=>k(t.target.value),fullWidth:!0,margin:"normal",required:!0,error:!!y.title,helperText:y.title})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:"Category",value:(i==null?void 0:i.category)||"",fullWidth:!0,margin:"normal",InputProps:{readOnly:!0}})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:"Start Date",type:"date",value:g||"",onChange:t=>o(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,margin:"normal",required:!0,error:!!y.startDate,helperText:y.startDate})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:"Deadline",type:"date",value:b||"",onChange:t=>T(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,margin:"normal",required:!0,error:!!y.deadline,helperText:y.deadline,inputProps:{min:g||void 0}})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:"Location",value:L||"",onChange:t=>R(t.target.value),fullWidth:!0,margin:"normal",required:!0,error:!!y.location,helperText:y.location})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:"Partner (optional)",value:B||"",onChange:t=>M(t.target.value),fullWidth:!0,margin:"normal"})}),e.jsx(h,{item:!0,xs:12,children:e.jsxs(a,{sx:{mb:2},children:[e.jsxs(n,{variant:"subtitle2",sx:{mb:.5},children:["Completion: ",r,"%"]}),e.jsx($e,{variant:"determinate",value:r,sx:{height:12,borderRadius:6,backgroundColor:"#eee","& .MuiLinearProgress-bar":{backgroundColor:s}}})]})}),e.jsxs(h,{item:!0,xs:12,children:[e.jsx(n,{variant:"subtitle1",sx:{mt:2},children:"Project Tasks"}),e.jsx(h,{container:!0,spacing:2,sx:{mt:1,display:"flex",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"stretch"},children:v.length===0?e.jsx(h,{item:!0,xs:12,children:e.jsx(n,{color:"text.secondary",sx:{mb:2},children:"No tasks allocated yet."})}):v.map((t,c)=>e.jsx(h,{item:!0,xs:12,sm:6,md:4,sx:{display:"flex"},children:e.jsxs(Z,{sx:{background:"#23272f",color:"#fff",borderRadius:2,boxShadow:3,mb:2,position:"relative",minHeight:160,height:"100%",width:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"stretch",maxWidth:320},children:[e.jsx(a,{sx:{position:"absolute",top:10,right:10},children:e.jsx(oe,{size:"small",onClick:()=>ae(c),sx:{color:"#fff"},children:e.jsx(ft,{})})}),e.jsxs(ze,{sx:{pb:"8px !important"},children:[e.jsxs(a,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(a,{display:"flex",alignItems:"center",gap:1,children:t.staffInitials&&e.jsx(a,{sx:{width:32,height:32,borderRadius:"50%",background:"#1976d2",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:16,ml:"auto"},children:t.staffInitials})}),e.jsx(st,{checked:!!t.completed,onChange:x=>ne(c,x.target.checked),sx:{color:"#4caf50","&.Mui-checked":{color:"#4caf50"}}}),e.jsx(n,{variant:"subtitle1",sx:{flexGrow:1,textDecoration:t.completed?"line-through":"none",color:"#fff",fontWeight:500,fontSize:16},children:t.name})]}),e.jsxs(a,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx("span",{style:{display:"inline-block",width:8,height:8,borderRadius:"50%",background:"#ffb300"}}),e.jsx(n,{variant:"body2",sx:{color:"#fff"},children:t.assignedStaff&&t.assignedStaff.length>0?t.assignedStaff.map(x=>{const q=O.find(qe=>qe.employee_id===x);return q?`${q.first_name} ${q.last_name}`:x}).join(", "):"Unassigned"})]}),e.jsxs(a,{display:"flex",alignItems:"center",gap:1,children:[e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",background:"#8bc34a",color:"#23272f",borderRadius:4,padding:"2px 8px",fontWeight:600,fontSize:13},children:[e.jsx("svg",{style:{marginRight:4},width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})}),t.deadline?new Date(t.deadline).toISOString().slice(0,10):""]}),!t.completed&&t.deadline&&new Date(t.deadline)<new Date&&e.jsx("span",{style:{color:"#ff5252",fontWeight:600,marginLeft:8},children:"Overdue"})]})]})]})},c))}),!V&&e.jsx(a,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(H,{variant:"outlined",startIcon:e.jsx(Pe,{}),onClick:()=>J(!0),children:"Add Task"})}),V&&e.jsxs(h,{container:!0,spacing:2,alignItems:"center",sx:{mt:1},children:[e.jsx(h,{item:!0,xs:12,sm:4,children:e.jsx(S,{label:"Task",value:C,onChange:t=>K(t.target.value),fullWidth:!0,error:!!y.tasks,helperText:y.tasks})}),e.jsx(h,{item:!0,xs:12,sm:4,children:e.jsxs(FormControl,{fullWidth:!0,children:[e.jsx(InputLabel,{children:"Assign Staff"}),e.jsx(Select,{multiple:!0,value:I,onChange:t=>$(t.target.value),input:e.jsx(OutlinedInput,{label:"Assign Staff"}),renderValue:t=>e.jsx(a,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(c=>{const x=O.find(q=>q.employee_id===c);return e.jsx(Chip,{label:x?`${x.first_name} ${x.last_name}`:c},c)})}),children:O.map(t=>e.jsxs(MenuItem,{value:t.employee_id,children:[t.first_name," ",t.last_name," (",t.email,")"]},t.employee_id))})]})}),e.jsx(h,{item:!0,xs:12,sm:3,children:e.jsx(S,{label:"Task Deadline",type:"date",value:G,onChange:t=>E(t.target.value),InputLabelProps:{shrink:!0},fullWidth:!0})}),e.jsx(h,{item:!0,xs:12,sm:1,children:e.jsx(H,{variant:"contained",color:"primary",startIcon:e.jsx(Pe,{}),onClick:re,sx:{height:56,minWidth:80,mt:{xs:2,sm:0}},fullWidth:!0,children:"ADD"})})]})]}),e.jsx(h,{item:!0,xs:12,children:e.jsx(S,{label:"Additional Notes",value:z||"",onChange:t=>N(t.target.value),fullWidth:!0,multiline:!0,minRows:3,margin:"normal"})})]}),e.jsx(a,{sx:{display:"flex",justifyContent:"center",mt:6},children:e.jsx(H,{variant:"contained",color:"primary",onClick:m,sx:{minWidth:200,fontWeight:600,fontSize:18},children:"UPDATE PROJECT"})}),e.jsx(ve,{open:A.open,autoHideDuration:2500,onClose:()=>P({...A,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(ye,{onClose:()=>P({...A,open:!1}),severity:A.severity,sx:{width:"100%"},children:A.message})})]})]})}var Se={},St=le;Object.defineProperty(Se,"__esModule",{value:!0});var ue=Se.default=void 0,Ct=St(de()),kt=e;ue=Se.default=(0,Ct.default)((0,kt.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");var Ce={},It=le;Object.defineProperty(Ce,"__esModule",{value:!0});var Re=Ce.default=void 0,wt=It(de()),Tt=e;Re=Ce.default=(0,wt.default)((0,Tt.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle");var ke={},Wt=le;Object.defineProperty(ke,"__esModule",{value:!0});var xe=ke.default=void 0,Dt=Wt(de()),Pt=e;xe=ke.default=(0,Dt.default)((0,Pt.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"RadioButtonUnchecked");var Ie={},_t=le;Object.defineProperty(Ie,"__esModule",{value:!0});var Ne=Ie.default=void 0,Mt=_t(de()),zt=e;Ne=Ie.default=(0,Mt.default)((0,zt.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");var we={},$t=le;Object.defineProperty(we,"__esModule",{value:!0});var Ee=we.default=void 0,Lt=$t(de()),Ot=e;Ee=we.default=(0,Lt.default)((0,Ot.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");function At({status:p}){let l="#bdbdbd",i=0,u=e.jsx(xe,{sx:{fontSize:70,color:l}});return p==="Completed"?(l="#43a047",u=e.jsxs(a,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(Re,{sx:{fontSize:70,color:l}}),e.jsx(ue,{sx:{color:l,fontSize:48,position:"absolute",top:10,left:10,transform:"rotate(0deg)"}})]})):p==="In Progress"?(l="#ffa726",i=90,u=e.jsxs(a,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(xe,{sx:{fontSize:70,color:l}}),e.jsx(ue,{sx:{color:l,fontSize:48,position:"absolute",top:10,left:10,transform:`rotate(${i}deg)`}})]})):p==="Not Started"&&(l="#bdbdbd",i=-90,u=e.jsxs(a,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(xe,{sx:{fontSize:70,color:l}}),e.jsx(ue,{sx:{color:l,fontSize:48,position:"absolute",top:10,left:10,transform:`rotate(${i}deg)`}})]})),u}const ce=["#43a047","#1976d2","#8e24aa","#fbc02d","#e53935","#00897b","#ff7043","#7e57c2"];function Rt({projectId:p}){var k,g;const[l,i]=d.useState(null),[u,D]=d.useState(!1);if(d.useEffect(()=>{p&&fetch(`${X}/api/projects/${p}`,{credentials:"include"}).then(o=>o.json()).then(o=>{console.log("Project data with orders:",o),i(o)}).catch(o=>console.error("Error fetching project:",o))},[p]),!l)return null;let f=l.status||"Not Started";l.totalTasks>0&&(l.completedTasks===l.totalTasks?f="Completed":l.completedTasks>0?f="In Progress":f="Not Started");const w=(l.tasks||[]).map(o=>({initials:o.staffInitials,name:`${o.firstName} ${o.lastName}`,role:o.role||o.staffRole||"Staff"})).filter((o,b,T)=>o.initials&&T.findIndex(L=>L.initials===o.initials)===b),j={pending:"warning",delivered:"success",cancelled:"error"};return e.jsx(a,{sx:{p:4,maxWidth:1200,mx:"auto"},children:e.jsxs(Z,{sx:{borderRadius:4,boxShadow:3,p:3},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(n,{variant:"h4",sx:{flexGrow:1,fontWeight:700,color:"#1976d2"},children:l.title}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(At,{status:f}),e.jsx(n,{variant:"h6",sx:{ml:1,fontWeight:700,color:f==="Completed"?"#43a047":f==="In Progress"?"#ffa726":"#bdbdbd"},children:f})]})]}),e.jsx(n,{variant:"h6",color:"text.secondary",sx:{mb:1},children:l.category}),e.jsx(U,{sx:{my:2}}),e.jsxs(a,{sx:{mb:3},children:[e.jsx(n,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:"Project Financial Summary"}),e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,sm:4,children:e.jsxs(Z,{sx:{p:3,textAlign:"center",bgcolor:"#e3f2fd",borderRadius:2,height:"100%"},children:[e.jsx(a,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:e.jsx(ct,{sx:{fontSize:40,color:"#1976d2"}})}),e.jsx(n,{variant:"h4",sx:{fontWeight:700,color:"#1976d2",mb:1},children:l.totalOrders||0}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontWeight:600},children:"Total Orders"})]})}),e.jsx(h,{item:!0,xs:12,sm:4,children:e.jsxs(Z,{sx:{p:3,textAlign:"center",bgcolor:"#e8f5e8",borderRadius:2,height:"100%"},children:[e.jsx(a,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:e.jsx(n,{variant:"h2",sx:{fontSize:40,color:"#43a047",fontWeight:700},children:"R"})}),e.jsxs(n,{variant:"h4",sx:{fontWeight:700,color:"#43a047",mb:1},children:["R",(l.totalSpent||0).toFixed(2)]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontWeight:600},children:"Total Spent"})]})}),e.jsx(h,{item:!0,xs:12,sm:4,children:e.jsxs(Z,{sx:{p:3,textAlign:"center",bgcolor:"#fff3e0",borderRadius:2,height:"100%"},children:[e.jsx(a,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:e.jsx(n,{variant:"h2",sx:{fontSize:40,color:"#f57c00",fontWeight:700},children:"R"})}),e.jsxs(n,{variant:"h4",sx:{fontWeight:700,color:"#f57c00",mb:1},children:["R",l.totalOrders>0?(l.totalSpent/l.totalOrders).toFixed(2):"0.00"]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontWeight:600},children:"Average per Order"})]})})]}),l.totalOrders>0&&e.jsxs(a,{sx:{mt:2},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>D(!u),children:[e.jsxs(n,{variant:"subtitle1",sx:{fontWeight:600,mr:1},children:["Order Details (",l.totalOrders," orders)"]}),e.jsx(oe,{size:"small",children:u?e.jsx(Ee,{}):e.jsx(Ne,{})})]}),e.jsx(rt,{in:u,children:e.jsx(at,{component:he,sx:{mt:2,maxHeight:400},children:e.jsxs(nt,{stickyHeader:!0,size:"small",children:[e.jsx(it,{children:e.jsxs(De,{children:[e.jsx(F,{children:"Order #"}),e.jsx(F,{children:"Customer"}),e.jsx(F,{align:"right",children:"Amount"}),e.jsx(F,{children:"Status"}),e.jsx(F,{children:"Date"})]})}),e.jsx(ot,{children:(l.ordersList||[]).map(o=>e.jsxs(De,{children:[e.jsx(F,{children:o.orderno}),e.jsx(F,{children:o.customer}),e.jsxs(F,{align:"right",children:["R",o.amount.toFixed(2)]}),e.jsx(F,{children:e.jsx(ee,{label:o.status.charAt(0).toUpperCase()+o.status.slice(1),color:j[o.status]||"default",size:"small"})}),e.jsx(F,{children:o.deliveryDate?new Date(o.deliveryDate).toLocaleDateString():new Date(o.createdAt).toLocaleDateString()})]},o.orderno))})]})})})]})]}),e.jsx(U,{sx:{my:2}}),e.jsxs(h,{container:!0,spacing:2,children:[e.jsxs(h,{item:!0,xs:12,sm:6,children:[e.jsxs(n,{children:[e.jsx("b",{style:{color:"#43a047"},children:"Start Date:"})," ",e.jsx("span",{style:{color:"#43a047"},children:(k=l.start_date)==null?void 0:k.toString().slice(0,10)})]}),e.jsxs(n,{children:[e.jsx("b",{style:{color:"#e53935"},children:"Deadline:"})," ",e.jsx("span",{style:{color:"#e53935"},children:(g=l.deadline)==null?void 0:g.toString().slice(0,10)})]}),e.jsxs(n,{children:[e.jsx("b",{children:"Location:"}),e.jsx("br",{}),e.jsx("span",{style:{whiteSpace:"pre-line"},children:l.location})]}),e.jsxs(n,{children:[e.jsx("b",{children:"Partner:"})," ",l.partner]})]}),e.jsxs(h,{item:!0,xs:12,sm:6,children:[e.jsxs(n,{children:[e.jsx("b",{children:"Category:"})," ",l.category]}),e.jsxs(n,{children:[e.jsx("b",{children:"Notes:"})," ",l.notes||"-"]})]})]}),e.jsx(U,{sx:{my:2}}),e.jsx(n,{variant:"h6",sx:{mb:1},children:"Tasks"}),e.jsx(a,{sx:{mb:2},children:(l.tasks||[]).length===0?e.jsx(n,{color:"text.secondary",children:"No tasks allocated yet."}):e.jsx(h,{container:!0,spacing:2,alignItems:"stretch",children:l.tasks.map((o,b)=>{var T;return e.jsx(h,{item:!0,xs:12,sm:6,md:4,sx:{display:"flex"},children:e.jsxs(Z,{sx:{background:"#f5f5f5",borderRadius:2,boxShadow:1,p:2,minHeight:200,height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-between"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(se,{sx:{bgcolor:ce[b%ce.length],mr:1,width:56,height:56,fontSize:24,fontWeight:700},children:o.staffInitials||"NA"}),e.jsxs(a,{children:[e.jsx(n,{sx:{fontWeight:600},children:o.name}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:[o.firstName," ",o.lastName]}),e.jsx(n,{variant:"caption",color:"text.secondary",children:o.role||"Staff"})]})]}),e.jsxs(n,{variant:"body2",sx:{mb:.5},children:[e.jsx("b",{children:"Deadline:"})," "," ",e.jsx("span",{style:{color:"#e53935"},children:(T=o.taskDeadline)==null?void 0:T.toString().slice(0,10)})]}),e.jsx(ee,{label:o.completed?"Completed":"Pending",size:"small",sx:{bgcolor:o.completed?"#43a047":"#ffa726",color:"#fff",fontWeight:600,mt:.5,fontSize:16,height:32}})]})},o.id||b)})})}),e.jsx(U,{sx:{my:2}}),e.jsx(n,{variant:"h6",sx:{mb:1},children:"Team Involved"}),e.jsx(a,{sx:{display:"flex",gap:3,flexWrap:"wrap",mb:4},children:w.length===0?e.jsx(n,{color:"text.secondary",children:"No team members assigned."}):w.map((o,b)=>e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(se,{sx:{bgcolor:ce[b%ce.length],width:56,height:56,fontSize:22,fontWeight:700,mb:1},children:o.initials}),e.jsx(n,{sx:{fontWeight:600},children:o.initials}),e.jsx(n,{variant:"caption",color:"text.secondary",children:o.role})]},b))}),e.jsx(U,{sx:{my:2}}),e.jsx(a,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(n,{variant:"subtitle1",sx:{fontWeight:600,color:"#1976d2"},children:"Managed by: Lynette Johnson"})})]})})}const Nt=[{label:"Project Status",value:"status"},{label:"Name",value:"name"},{label:"Deadline",value:"deadline"},{label:"Category",value:"category"},{label:"Location",value:"location"}],Me=[{label:"All",value:"all"},{label:"Training Program",value:"training"},{label:"Product Launching",value:"product"},{label:"Handicraft Program",value:"handicraft"},{label:"Speaker Program",value:"speaker"}];function Et(p,l){switch(l){case"name":return[...p].sort((i,u)=>i.title.localeCompare(u.title));case"deadline":return[...p].sort((i,u)=>new Date(i.deadline)-new Date(u.deadline));case"category":return[...p].sort((i,u)=>i.category.localeCompare(u.category));case"location":return[...p].sort((i,u)=>i.location.localeCompare(u.location));case"status":default:return[...p].sort((i,u)=>i.status.localeCompare(u.status))}}function qt(){var Y,r;const[p,l]=d.useState(""),[i,u]=d.useState("all"),[D,f]=d.useState("status"),[w,j]=d.useState(!1),[k,g]=d.useState([]),[o,b]=d.useState(!0),[T,L]=d.useState(!1),[R,B]=d.useState(null),[M,z]=d.useState({open:!1,message:"",severity:"success"}),[N,v]=d.useState(!1),[W,C]=d.useState(null),[K,I]=d.useState(null),$=async()=>{b(!0),B(null);try{const s=await fetch(`${X}/api/projects`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch projects");const m=await s.json();g(m)}catch(s){B(s.message||"Error fetching projects")}finally{b(!1)}};d.useEffect(()=>{$()},[]);const G=k.filter(s=>(i==="all"||s.category===i)&&s.title.toLowerCase().includes(p.toLowerCase())),E=Et(G,D),O=()=>j(!0),Q=()=>j(!1),[A,P]=d.useState(!1),[y,te]=d.useState(null),V=s=>{te(s),P(!0)},J=()=>P(!1),re=()=>{P(!1),$(),z({open:!0,message:"Project updated successfully!",severity:"success"})},ae=async s=>{j(!1),L(!0);try{await $(),z({open:!0,message:`Project "${(s==null?void 0:s.title)||(s==null?void 0:s.projectName)||"New project"}" created and list updated successfully!`,severity:"success"})}catch(m){console.error("Error refreshing projects:",m),z({open:!0,message:"Project created but failed to refresh list. Please refresh manually.",severity:"warning"})}finally{L(!1)}},ne=s=>{C(s),I(s.id),v(!0)},ie=()=>v(!1);return e.jsxs(a,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",p:0},children:[e.jsxs(a,{sx:{bgcolor:"rgba(255,255,255,0.95)",backdropFilter:"blur(10px)",borderBottom:"3px solid #667eea",p:4,mb:0,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:3,mb:2},children:[e.jsx(se,{sx:{bgcolor:"#667eea",width:64,height:64,boxShadow:"0 6px 16px rgba(102, 126, 234, 0.3)"},children:e.jsx(fe,{sx:{fontSize:36,color:"white"}})}),e.jsxs(a,{sx:{textAlign:"center"},children:[e.jsx(n,{variant:"h3",sx:{fontWeight:"bold",background:"linear-gradient(45deg, #667eea, #764ba2)",backgroundClip:"text",color:"transparent",mb:1},children:"Project Management"}),e.jsx(n,{variant:"h6",sx:{color:"#64748b",fontWeight:"500"},children:"Plan, organize, and track your project workflows"}),e.jsxs(n,{variant:"body2",sx:{color:"#94a3b8",fontWeight:"400",mt:1},children:["Access Level: ",((Y=xt())==null?void 0:Y.role)||"Unknown"," • Projects Module"]})]})]}),e.jsxs(he,{sx:{p:3,mt:3,borderRadius:3,background:"rgba(255,255,255,0.9)",backdropFilter:"blur(10px)",boxShadow:"0 8px 32px rgba(0,0,0,0.1)",border:"1px solid rgba(255,255,255,0.2)"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(lt,{sx:{color:"#667eea",fontSize:28}}),e.jsx(n,{variant:"h6",sx:{fontWeight:"bold",color:"#2d3748"},children:"Search & Filter Projects"})]}),e.jsx(U,{sx:{mb:3,borderColor:"#667eea",borderWidth:1}}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:{xs:"wrap",sm:"nowrap"}},children:[e.jsx(S,{label:"Search projects...",variant:"outlined",size:"medium",value:p,onChange:s=>l(s.target.value),InputProps:{startAdornment:e.jsx(dt,{sx:{color:"#667eea",mr:1}})},sx:{flex:2,minWidth:280,"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"#667eea",borderWidth:2},"&.Mui-focused fieldset":{borderColor:"#667eea",borderWidth:2}},"& .MuiInputLabel-root.Mui-focused":{color:"#667eea"}}}),e.jsxs(me,{size:"medium",sx:{minWidth:180},children:[e.jsx(pe,{children:"Sort by"}),e.jsx(ge,{value:D,label:"Sort by",onChange:s=>f(s.target.value),sx:{"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#48bb78",borderWidth:2},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#48bb78",borderWidth:2}},children:Nt.map(s=>e.jsx(be,{value:s.value,children:s.label},s.value))})]}),e.jsxs(me,{size:"medium",sx:{minWidth:180},children:[e.jsx(pe,{children:"Category"}),e.jsx(ge,{value:i,label:"Category",onChange:s=>u(s.target.value),sx:{"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#ed8936",borderWidth:2},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#ed8936",borderWidth:2}},children:Me.map(s=>e.jsx(be,{value:s.value,children:s.label},s.value))})]}),e.jsx(H,{variant:"contained",startIcon:e.jsx(Oe,{}),size:"large",onClick:O,sx:{py:1.8,px:4,fontWeight:"bold",fontSize:16,borderRadius:2,minWidth:200,background:"linear-gradient(45deg, #667eea, #764ba2)",color:"white",textTransform:"none",whiteSpace:"nowrap",boxShadow:"0 4px 16px rgba(102, 126, 234, 0.3)","&:hover":{background:"linear-gradient(45deg, #5a67d8, #6b46c1)",transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(102, 126, 234, 0.4)"}},children:"Create Project"})]}),e.jsxs(a,{sx:{mt:3,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(ee,{label:`Total Projects: ${k.length}`,sx:{bgcolor:"#667eea",color:"white",fontWeight:"bold",fontSize:"0.9rem"}}),e.jsx(ee,{label:`Filtered: ${E.length}`,sx:{bgcolor:"#48bb78",color:"white",fontWeight:"bold",fontSize:"0.9rem"}}),i!=="all"&&e.jsx(ee,{label:`Category: ${(r=Me.find(s=>s.value===i))==null?void 0:r.label}`,sx:{bgcolor:"#ed8936",color:"white",fontWeight:"bold",fontSize:"0.9rem"}})]})]})]}),e.jsx(a,{sx:{p:4,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",minHeight:"calc(100vh - 280px)"},children:e.jsx(he,{sx:{p:4,borderRadius:3,background:"rgba(255,255,255,0.95)",backdropFilter:"blur(10px)",boxShadow:"0 20px 40px rgba(0,0,0,0.1)",border:"1px solid rgba(255,255,255,0.2)",minHeight:"400px"},children:o||T?e.jsxs(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"300px",flexDirection:"column",gap:2},children:[e.jsx(se,{sx:{bgcolor:"#667eea",width:80,height:80,animation:"pulse 2s infinite"},children:e.jsx(fe,{sx:{fontSize:40}})}),e.jsx(n,{variant:"h6",sx:{color:"#64748b"},children:T?"Updating projects...":"Loading projects..."})]}):R?e.jsxs(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"300px",flexDirection:"column",gap:2},children:[e.jsx(n,{variant:"h6",color:"error",sx:{textAlign:"center"},children:R}),e.jsx(H,{variant:"contained",onClick:$,sx:{background:"linear-gradient(45deg, #667eea, #764ba2)","&:hover":{background:"linear-gradient(45deg, #5a67d8, #6b46c1)"}},children:"Retry"})]}):e.jsx(pt,{projects:E,onEdit:V,onView:ne})})}),e.jsx(ve,{open:M.open,autoHideDuration:4e3,onClose:()=>z({...M,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(ye,{onClose:()=>z({...M,open:!1}),severity:M.severity,sx:{width:"100%"},children:M.message})}),e.jsx(jt,{open:w,onClose:Q,onSave:ae}),y&&e.jsx(yt,{open:A,onClose:J,project:y,onSave:re}),W&&e.jsx(je,{open:N,onClose:ie,maxWidth:"md",fullWidth:!0,scroll:"body",children:e.jsx(a,{sx:{p:2},children:e.jsx(Rt,{projectId:K})})})]})}const Jt=ut(qt,"projects");export{qt as Projects,Jt as default};
